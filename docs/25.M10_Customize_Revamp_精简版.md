# M10 简历定制重构 - 精简版指南 (Simplified Guide)

> **文档定位**: 本文档为 M10 重构的高层概览，用于快速理解业务价值、核心方案与迭代节奏。详细技术规范请查阅 [24.M10_Customize_Revamp.md](./24.M10_Customize_Revamp.md)。

## 1. Why: 为什么要重构？

目前的 Demo 版本存在“三宗罪”，无法满足真实求职场景：

1.  **不可编辑 (Uneditable)**: 生成的 Markdown 文本难以进行精细化的二次调整（如改错别字、微调经历）。
2.  **体验割裂 (Poor UX)**: 缺乏“所见即所得”的排版预览，用户无法感知最终 PDF 效果。
3.  **深度不足 (Shallow)**: 简单的 LLM 生成缺乏针对 JD 的深度思考，生成的简历往往“像模像样但无灵魂”。

**重构愿景**: 打造一个 **“结构化、可交互、有深度”** 的简历定制工作台。

---

## 2. What: 我们要做什么？

我们将把产品形态从 **“文本生成器”** 升级为 **“智能简历编辑器”**。

### 核心能力矩阵

| 能力维度     | 旧版 (Demo)   | **新版 (Production)**                |
| :----------- | :------------ | :----------------------------------- |
| **数据格式** | Markdown 文本 | **结构化 JSON** (Zod Schema 约束)    |
| **编辑体验** | 文本框修改    | **左侧表单编辑 + 右侧实时预览**      |
| **AI 智能**  | 简单生成      | **DeepSeek-Reasoner (CoT) 深度推理** |
| **模版系统** | 单一样式      | **多模版切换** (经典/现代/创意等)    |
| **移动端**   | 布局错乱      | **适配优化** (预览为主，抽屉编辑)    |

---

## 3. How: 核心技术方案

### 3.1 数据流转 (Data Flow)

1.  **Input**: 简历摘要 + 详细履历摘要(optional) + JD 摘要 + 匹配分析 + RAG 知识库。
2.  **Process (Worker)**:
    - 使用 `DeepSeek Reasoner` 进行思维链推理 (CoT)。
    - 输出包含 `optimizeSuggestion` (修改思路) 和 `resumeData` (结构化数据) 的 JSON。
3.  **Storage (DB)**: 存入 `CustomizedResume` 表 (JSON 字段)。
4.  **Output (Frontend)**:
    - 使用 `Zustand` 加载 JSON 数据。
    - `ResumeCanvas` 组件根据 JSON 渲染 HTML。
    - `react-to-print` 将 HTML 导出为 PDF。

### 3.2 关键技术栈

- **Backend**: Next.js Server Actions, Prisma (JSON type), Upstash QStash (Queue).
- **AI**: DeepSeek R1 (Reasoning Model), Zod Schema Injection.
- **Frontend**:
  - State: `zustand` + `immer` (复杂对象更新).
  - DnD: `@dnd-kit/core` (模块拖拽排序).
  - Forms: `react-hook-form` (表单绑定).

---

## 4. Plan: 迭代执行计划

我们将重构工作拆解为 5 个独立的里程碑 (Milestones)，每个阶段可独立验收。

### Phase 1: 数据底座 (Foundation)

- **目标**: 完成数据库 Schema 变更和 TypeScript 类型定义。
- **产出**: 更新后的 `schema.prisma`，新的 `resume-schema.ts` (Zod)。

### Phase 2: 智能引擎 (AI Worker)

- **目标**: 实现后端异步任务，确保 AI 能稳定输出符合 Schema 的 JSON。
- **产出**: `CustomizeResumeStrategy` (Worker), DeepSeek Prompt, JSON 清洗逻辑。

### Phase 3: 状态管理 (State Manager)

- **目标**: 构建前端数据流，实现数据的加载、修改和自动保存。
- **产出**: `useResumeStore` (Zustand), `updateAction` (Server Action)。

### Phase 4: 编辑器构建 (Editor UI)

- **目标**: 实现核心交互界面，包括侧边栏表单、画布预览、拖拽排序。
- **产出**: `ResumeEditorLayout`, `EditorSidebar`, `ModuleManager`。

### Phase 5: 模版与交付 (Polish)

- **目标**: 实现多模版渲染、PDF 导出及移动端适配，达到上线标准。
- **产出**: 6 款简历模版组件, PDF 导出功能, Mobile 适配样式。

---

> **Next Step**: 请参照 [详细方案文档](./24.M10_Customize_Revamp.md) 开始 **Phase 1** 的执行。
