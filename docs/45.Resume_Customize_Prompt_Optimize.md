# M10 简历定制化 Prompt 优化方案

> **文档状态**: RFC (Request for Comments)  
> **最后更新**: 2025-01-03  
> **责任人**: AI IDE

---

## 1. 背景与问题

### 1.1 产品定位

用户上传个人简历和详细履历后，针对特定 JD 获取 AI 定制化简历。AI 的价值在于：
- **保留精华**：尊重用户已梳理的简历内容
- **精准增益**：针对 JD 进行最小必要的优化
- **用户安全感**：让用户感受到"AI 懂我"，而非"AI 替我写"

### 1.2 当前问题

| 问题 | 表现 | 根因 |
|---|---|---|
| 内容丢失 | 原简历的重要信息未被保留 | Prompt 定位为"重写"而非"增值编辑" |
| 定制化增益弱 | 输出像是"换了措辞"，无实质提升 | CoT 缺乏结构化的"JD→简历"映射逻辑 |
| 补丁感强 | 多处硬编码约束，感觉像打补丁 | 缺乏统一的核心策略指令 |
| Free 模型不适配 | GLM Flash 跑不动复杂 Prompt | 未区分 Paid/Free 路径 |

---

## 2. 核心策略：三层内容处理模型

```
┌─────────────────────────────────────────────────────────────────┐
│  Layer 1: PRESERVE (保留)                                        │
│  - 原简历中"已经足够好"的表达 → 原样保留                            │
│  - 判断标准：已含 JD 关键词、有量化数据、逻辑清晰                      │
├─────────────────────────────────────────────────────────────────┤
│  Layer 2: REFINE (微调)                                          │
│  - 原简历中"表达不够好"的部分 → 精准润色                             │
│  - 典型操作：弱动词→强动词、模糊描述→量化、JD术语替换                  │
├─────────────────────────────────────────────────────────────────┤
│  Layer 3: AUGMENT (增益)                                         │
│  - 详细履历中有、但原简历未采用的 Golden Points                      │
│  - 谨慎引入：仅当能显著提升 JD 匹配度时才添加                         │
│  - 融合方式：织入现有段落，避免突兀                                   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. Prompt 改动设计

### 3.1 角色定位调整

| 维度 | Before | After |
|---|---|---|
| 角色 | "资深职业教练...将通用简历转化为高影响力定制简历" | "简历增值编辑...在尊重用户原稿基础上进行最小必要的精准优化" |
| 隐含姿态 | AI 是作者 | AI 是编辑，用户是作者 |
| 改动幅度 | 暗示"重写" | 强调"克制"，每处改动需有明确加分理由 |

### 3.2 输入源层级重定义

| 输入 | Before | After |
|---|---|---|
| `resume_summary_json` | "事实来源 - 核心" | "定稿基准 - 最大限度保留" |
| `detailed_resume_summary_json` | "事实来源 - 补充" | "素材库 - 用于 Layer 3 Augment" |
| `match_analysis_json` | 仅用于策略参考 | 核心输入：Strengths 指导强化，Weaknesses 指导补齐 |
| `rag_context` | "写作技巧参考" | 仅在 Layer 2 Refine 时参考，禁止替换用户原有内容 |

### 3.3 新版 CoT 思维链

```
Step 1: 【JD 痛点分析】
  - 提取 JD 中 3-5 个核心需求 (Must-haves)
  - 识别匹配报告中的 Weaknesses（待补齐项）

Step 2: 【原简历扫描】
  - 逐条检查原简历每个要点
  - 标记处理策略：
    ✅ PRESERVE - 已覆盖 JD 需求，保留原文
    ⚠️ REFINE - 有素材但表达弱，需润色
    ❌ AUGMENT - JD 需求未覆盖，需从详细履历补充

Step 3: 【增益点挖掘】
  - 针对 ❌ 项，检索详细履历中是否有可用素材
  - 仅当找到高价值素材时执行 AUGMENT
  - 融合方式：织入最相关的现有段落

Step 4: 【执行改动】
  - PRESERVE: 直接复制原文
  - REFINE: 仅修改措辞，不改变语义
  - AUGMENT: 新增内容自然融入现有结构

Step 5: 【改动说明 (optimizeSuggestion)】
  - 格式：改动位置 + Before/After + 改动理由（关联 JD）
```

### 3.4 `optimizeSuggestion` 输出升级

**Before**: "关键修改点及其理由的摘要（3-5点）"

**After**: 
```
列出本次最关键的 3-5 处改动，每处需包含：
1. **改动位置**：哪个模块、哪条经历
2. **改动内容**：Before → After 简述
3. **改动理由**：为什么能加分（关联 JD 需求）
```

---

## 4. Paid vs Free 路径分流

### 4.1 路由逻辑

| 路径 | 模型 | Prompt 复杂度 | 用户预期管理 |
|---|---|---|---|
| Paid | DeepSeek Reasoner (R1) | 完整版 (含 CoT) | 正常流程 |
| Free | GLM 4.5 Flash | 精简版 (直接指令) | 前置 Popup 提示 + 引导充值 |

### 4.2 Free 路径精简策略

- 移除显式 CoT 步骤（Flash 不支持 Reasoning Channel）
- 简化输入：仅使用 `resume_summary` + `job_summary`
- 降低输出期望：告知用户"基础优化"vs"深度定制"

### 4.3 Free 路径用户提示

在点击"定制化简历"时弹窗：
> **基础模式提示**  
> 当前为基础优化模式，将提供简要的简历调整建议。  
> 如需 AI 深度定制（含详细履历挖掘、JD 精准匹配），请升级至 Pro。

---

## 5. 执行计划

### Phase 1: Planning ✓
- [x] 完成方案设计文档

### Phase 2: Prompt Engineering (Paid)
- [ ] 重写 `zh.ts` 的 `resume_customize` (System + User Prompt)
- [ ] 重写 `en.ts` 的 `resume_customize` (System + User Prompt)

### Phase 3: Free Path
- [ ] 创建 `resume_customize_lite` 精简版 Prompt (zh + en)
- [ ] 更新 Task Router 支持 Paid/Free 路径分流
- [ ] 添加 Free 路径前置 Popup 逻辑

### Phase 4: Verification
- [ ] 本地测试：用样本 inputs 验证输出质量
- [ ] E2E 测试：用户手动验收

---

## 6. 风险与回滚

| 风险 | 缓解措施 |
|---|---|
| 新 Prompt 导致输出不稳定 | 保留旧版 Prompt 作为回滚点 |
| Free 模型依然跑不动精简版 | 进一步简化或降级为"仅提供建议，不生成完整简历" |
| 用户反馈"改动太少" | 在 UI 上解释"精准优化"理念，或提供"激进模式"开关 |

---

## 附录：关键文件

- Prompt 定义：`lib/prompts/zh.ts`, `lib/prompts/en.ts`
- 路由配置：`lib/llm/task-router.ts`
- 历史文档：`docs/24.M10_Customize_Revamp.md`, `docs/36.M10_Customize_UX_Finetune.md`
