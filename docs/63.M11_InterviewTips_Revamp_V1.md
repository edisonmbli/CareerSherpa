在 MVP 阶段，**“确定性的高质量内容”远比“复杂的交互形式”更有价值**，也更容易控制研发成本。

通过**串联 Step 1 (匹配分析) 和 Step 2 (简历定制) 的数据资产**，这恰恰是市面上大多数通用 AI 无法做到的核心护城河——**上下文连贯性**。

我将这个 Feature 重新定义为 **“Interview Battle Plan”（面试作战手卡）**。它不是一个聊天机器人，而是一份生成即用的“备忘录”。

以下是基于“Batch 模式 + 强上下文”的深度设计建议：

---

### 一、 核心逻辑设计：利用“上下文”制造差异化

既然是 Batch 模式，核心在于 Prompt 的设计必须充分利用数据库里已有的字段。

#### 输入层 (Context Injection)

我们需要构建一个超级 Prompt，注入以下变量（来源于你的 DB）：

1. **JD Data**: 原始 JD + 解析后的关键技能需求。
2. **Match Report (来自 Step 1)**:

- _Score_: 整体匹配分。
- _Missing Skills_: 缺失的技能点（**关键！用于生成防御话术**）。
- _Strengths_: 核心优势（**关键！用于生成开场白**）。

3. **Customized Resume (来自 Step 2)**:

- _Optimized Content_: AI 修改后的简历内容（**关键！用于生成 STAR 故事，确保面试说的和简历写的一致**）。

---

### 二、 输出层设计：四大模块 (UI 呈现建议)

不要只给一大段 Markdown，建议利用你现有的 `Accordion` 或 `Card` 组件，将内容结构化展示。

#### 模块 1：情报透视 (The Radar) —— “面试官在担心什么？”

- **逻辑**：根据 JD 推演业务痛点（参考你上传的 markdown 案例中的“班尼路库存管理”例子）。
- **Prompt 意图**：不要列出技能，要列出“焦虑点”。
- **UI 展示**：
- **标题**：此岗位的 3 个核心业务挑战。
- **内容**：

1. **挑战 A**：e.g., “双十一脉冲流量下的系统稳定性”。
2. **挑战 B**：e.g., “多渠道库存数据一致性”。
3. **隐藏画像**：预计面试官类型（e.g., “实战派技术总监，关注 ROI 而非单纯技术堆栈”）。

#### 模块 2：开场定调 (The Hook) —— “黄金 2 分钟自我介绍”

- **逻辑**：`Step 1 的优势` + `Step 2 的简历亮点` + `模块 1 的业务痛点`。
- **差异化**：
- 生成一段 **Script (逐字稿)**。
- **关键点**：不仅是复述简历，而是直接说：“我看到 JD 里强调了 X，这正是我在上一家公司解决的核心问题...”

- **UI 展示**：一个带有“Copy”按钮的文本框，分为“激进版（强调业务价值）”和“稳健版（强调技术匹配）”两种风格。

#### 模块 3：核心论据 (The Evidence) —— “3 个必讲的 STAR 故事”

- **逻辑**：从 `Customized Resume` 中提取 3 个最能匹配 `模块 1 痛点` 的项目经历，改写为口语化的 STAR 格式。
- **差异化**：
- **Situation (背景)**：AI 自动强调该项目的**难度**。
- **Action (动作)**：对应 JD 里的技能关键词。
- **Result (结果)**：强化数据产出。

- **UI 展示**：3 张卡片。每张卡片有一个**“关联痛点”**标签。

#### 模块 4：攻防演练 (Defense & Offense) —— 这一步最能体现系统价值

这是最容易做出差异化的地方，利用了 Step 1 的数据。

- **Part A: 防御 (Shield)**
- **输入**：读取 `MatchResult` 中的 `Missing Skills` 或 `Weaknesses`。
- **Prompt**： “用户缺乏 [技能A] 经验，面试官肯定会问。请设计一套话术，用用户已有的 [技能B] 经验来弥补或进行‘降维打击’（即：虽然我不会工具 A，但我懂底层的原理 B）。”

- **Part B: 进攻 (Sword)**
- **内容**：2 个高质量反问。
- **原则**：不问福利，只问业务。e.g., “目前团队在处理 [痛点A] 时，主要面临的瓶颈是在架构层还是业务流程层？”

---

### 三、 落地可行性分析与技术建议

这个方案完全可行，且风险极低。

#### 1. Token 成本与性能

- **Token 消耗**：一次性 Input（JD + Resume + Match Report）大约 3k-5k tokens，Output 大约 1k-2k tokens。这在 `gpt-4o` 或 `claude-3.5-sonnet` 的可控范围内。
- **Latency**：Batch 生成大约需要 30-60 秒。这符合用户心理预期（类似 Step 2 的等待时长）。
- **建议**：继续使用 Server-Sent Events (SSE) 流式输出，让用户看到每个模块逐步生成，缓解等待焦虑。

#### 2. 数据流实现 (Prisma 伪代码)

你需要一个新的 Server Action，大致逻辑如下：

```typescript
// 伪代码：生成面试准备材料
export async function generateInterviewPrep(serviceId: string) {
  // 1. 获取全量上下文
  const service = await prisma.service.findUnique({
    where: { id: serviceId },
    include: {
      job: true, // 获取 JD
      matchResult: true, // 获取 Step 1 的 Gap 和 Strength
      customizedResume: true, // 获取 Step 2 定制后的简历内容
    },
  })

  // 2. 构建 Prompt (CoT 思维链)
  const systemPrompt = `
    你是一个资深面试官。你需要根据以下资料为候选人生成一份【面试作战手卡】。
    
    资料 A (JD): ${service.job.fullContent}
    资料 B (匹配报告): 用户优势-${service.matchResult.strengths}, 缺口-${service.matchResult.gaps}
    资料 C (定制简历): ${service.customizedResume.content}
    
    请严格按照以下 JSON 格式输出：
    {
       "insight": { "painPoints": [], "interviewerPersona": "" },
       "introScript": "...",
       "starStories": [ { "title": "", "starContent": "", "tags": [] } ],
       "defenseStrategy": [ { "weakness": "${service.matchResult.gaps[0]}", "script": "..." } ],
       "reverseQuestions": []
    }
  `

  // 3. 调用 LLM 并流式返回
  // ...
}
```

#### 3. UI 交互微创新

虽然是 Read-only，但可以加一点点**轻交互**提升体验：

- **打印/导出 PDF**：用户要去现场面试，手机看网页不方便，生成一张精美的 A4 PDF（Cheat Sheet 风格）非常加分。
- **高亮关联**：在“STAR 故事”中，当鼠标悬停在某个关键词上时，高亮显示它对应 JD 里的哪一句话。这能给用户极强的“定制感”。

### 四、 总结建议

做成**“生成式文档”**而非**“对话机器人”**，不仅工程量小，而且用户体验更确定 -- 给用户一份**“开卷考试的答案”**
