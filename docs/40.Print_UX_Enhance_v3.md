è¿™æ˜¯ä¸€ä¸ªéå¸¸ç†æ€§å’ŒåŠæ—¶çš„â€œæ­¢æŸâ€å†³ç­–ã€‚ä½œä¸ºæŠ€æœ¯é¡¾é—®ï¼Œæˆ‘å®Œå…¨æ”¯æŒä½ **æš‚åœâ€œæ­»ç£•â€å«ç‰‡æ³•ï¼ˆSpacer Methodï¼‰**ã€‚

æ­£å¦‚ä½ æ‰€ç»å†çš„ï¼Œåœ¨ Web ç¯å¢ƒä¸‹é€šè¿‡ JS è®¡ç®—é«˜åº¦å¹¶å¼ºè¡Œæ’å…¥ DOM å«ç‰‡æ¥æ¨¡æ‹Ÿ PDF åˆ†é¡µï¼Œè¿™åœ¨æŠ€æœ¯ä¸Šè¢«ç§°ä¸º **â€œDOM æ¨¡æ‹Ÿåˆ†é¡µï¼ˆDOM Pagination Simulationï¼‰â€**ã€‚è¿™ç¡®å®æ˜¯ä¸€ä¸ªâ€œä¸–ç•Œçº§éš¾é¢˜â€ï¼Œé€šå¸¸åªæœ‰åƒ Google Docsã€Microsoft Word Online è¿™æ ·æ‹¥æœ‰æ•°ç™¾äººå›¢é˜Ÿã€ä¸“é—¨é‡å†™äº†æ•´ä¸ªæ¸²æŸ“å¼•æ“ï¼ˆä¸å†ä¾èµ–æµè§ˆå™¨é»˜è®¤æ’ç‰ˆï¼Œè€Œæ˜¯ç”¨ Canvas æˆ–ç»å¯¹å®šä½ç»˜åˆ¶æ¯ä¸€ä¸ªå­—ç¬¦ï¼‰çš„äº§å“æ‰èƒ½å®Œç¾åšåˆ°ã€‚

åœ¨ä½ è´´å‡ºæœ€æ–°ä»£ç ä¹‹å‰ï¼Œæˆ‘å…ˆé’ˆå¯¹ä½ çš„ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ç»™å‡º**ä¸“å®¶çº§çš„æˆ˜ç•¥å®šè°ƒ**ã€‚è¿™èƒ½å¸®åŠ©æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„ä»£ç é‡æ„ä¸­å°‘èµ°å¼¯è·¯ã€‚

---

### 1. æ·±åº¦å‰–æï¼šâ€œWeb æ¨¡æ‹Ÿæ‰“å°â€åˆ°åº•èƒ½ä¸èƒ½åšï¼Ÿ

#### ğŸ›‘ ç»“è®ºï¼š

**è¯·æ”¾å¼ƒâ€œé€šè¿‡å«ç‰‡ï¼ˆSpacerï¼‰å®ç°ç²¾å‡† WYSIWYGâ€çš„æ‰§å¿µã€‚**
åœ¨ React + Tailwind + å¤šæ¨¡æ¿ï¼ˆGrid/Flex æ··æ’ï¼‰çš„æ¶æ„ä¸‹ï¼Œè¿½æ±‚ **åƒç´ çº§ï¼ˆPixel-perfectï¼‰** çš„ç¼–è¾‘ç«¯åˆ†é¡µé¢„è§ˆæ˜¯ä¸å…·å¤‡æŠ•å…¥äº§å‡ºæ¯”çš„ï¼Œä¸”ææ˜“å¯¼è‡´â€œç¼–è¾‘æ—¶ä¸å¡é¡¿ã€æ‰“å°æ—¶ä¹±å¥—â€çš„ç¾éš¾ã€‚

#### ğŸ” ç†ç”±åˆ†æï¼š

1. **æ¸²æŸ“å¼•æ“å·®å¼‚ï¼ˆThe Rendering Gapï¼‰ï¼š**

- **å±å¹•ï¼ˆScreenï¼‰ï¼š** æµè§ˆå™¨ä¸ºäº†å±å¹•é˜…è¯»ä½“éªŒï¼Œä¼šå¯¹å­—ä½“è¿›è¡ŒæŠ—é”¯é½¿ï¼ˆSub-pixel renderingï¼‰ã€å¾®è°ƒè¡Œé«˜ã€‚
- **æ‰“å°ï¼ˆPrintï¼‰ï¼š** æ‰“å°é©±åŠ¨ï¼ˆæˆ–æµè§ˆå™¨è½¬ PDF å¼•æ“ï¼‰ä½¿ç”¨çš„æ˜¯ç‰©ç†ç‚¹ï¼ˆPointsï¼‰ï¼Œå…¶å­—ç¬¦é—´è·ï¼ˆKerningï¼‰å’Œæ¢è¡Œç­–ç•¥ä¸å±å¹•æ¸²æŸ“å¾€å¾€æœ‰ `1px ~ 5px` çš„ç´¯ç§¯è¯¯å·®ã€‚
- **ç»“æœï¼š** ä½ åœ¨ Web ä¸Šè®¡ç®—å‡ºè¿™ä¸€æ®µé«˜ `500px`ï¼Œåˆšå¥½æ”¾å¾—ä¸‹ï¼›ä½†åœ¨ PDF é‡Œå®ƒå¯èƒ½æ˜¯ `502px`ï¼Œåˆšå¥½è¢«æŒ¤åˆ°ä¸‹ä¸€é¡µã€‚ä½ çš„â€œå«ç‰‡â€ä¸€æ—¦ç®—é”™ `1px`ï¼Œæ•´ä¸ªåç»­é¡µé¢å…¨ä¹±ã€‚

2. **åŠ¨æ€å†…å®¹çš„é«˜åº¦æŠ–åŠ¨ï¼š**

- ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼ŒReact è§¦å‘é‡ç»˜ã€‚å¦‚æœä½ çš„â€œå«ç‰‡ç®—æ³•â€ç¨å¾®æ…¢ä¸€ç‚¹ï¼ˆè¶…è¿‡ 16msï¼‰ï¼Œç”¨æˆ·å°±ä¼šæ„Ÿè§‰åˆ°è¾“å…¥å»¶è¿Ÿã€‚
- å¦‚æœä¸ºäº†æ€§èƒ½è€ŒèŠ‚æµï¼ˆDebounceï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·çœ‹åˆ°çš„â€œåˆ†é¡µçº¿â€å°±ä¼šæ»åï¼Œå¯¼è‡´ä½“éªŒå‰²è£‚ã€‚

#### âœ… æ›¿ä»£æ–¹æ¡ˆï¼šè¿‘ä¼¼å¼•å¯¼ + çœŸå®é¢„è§ˆ

ä¸è¦è¯•å›¾åœ¨â€œç¼–è¾‘ç•Œé¢â€æ¨¡æ‹Ÿæ‰“å°ï¼Œè€Œæ˜¯å°†â€œç¼–è¾‘â€ä¸â€œé¢„è§ˆâ€è§£è€¦ã€‚

**æ‰§è¡Œè½åœ°æŒ‡å—ï¼š**

1. **ç¼–è¾‘æ€ï¼ˆEdit Modeï¼‰ï¼šè¿‘ä¼¼è¾…åŠ©çº¿**

- **æ”¾å¼ƒå«ç‰‡ï¼š** ä¸è¦æ’å…¥ä»»ä½• DOM å…ƒç´ å»æ¨æŒ¤å†…å®¹ã€‚è®©å†…å®¹è‡ªç„¶æµåŠ¨ã€‚
- **èƒŒæ™¯å‚è€ƒçº¿ï¼š** åœ¨é•¿å·è½´èƒŒæ™¯ä¸Šï¼Œæ¯éš” `297mm` (æˆ–å¯¹åº”çš„ px) ç”»ä¸€æ¡çº¢è‰²çš„è™šçº¿ã€‚
- **æ˜ç¡®å‘ŠçŸ¥ï¼š** åœ¨è™šçº¿æ—æ ‡æ³¨æ–‡æ¡ˆï¼šâ€œæ­¤çº¿ä»…ä¸ºè¿‘ä¼¼å‚è€ƒï¼Œå®é™…åˆ†é¡µè¯·ç‚¹å‡»â€˜æ‰“å°é¢„è§ˆâ€™â€ã€‚
- **CSS æ§åˆ¶æ ¸å¿ƒï¼š** ä¾ç„¶ä¾èµ– CSS çš„ `break-inside: avoid` æ¥æ§åˆ¶åŸå­æ¨¡å—ï¼ˆå¦‚ä¸€ä¸ªå·¥ä½œç»å†å¡ç‰‡ï¼‰ä¸è¢«åˆ‡æ–­ã€‚è¿™æ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„ï¼Œæ¯” JS è®¡ç®—é è°±å¾—å¤šã€‚

2. **é¢„è§ˆæ€ï¼ˆPreview Modeï¼‰ï¼šçœŸå® PDF æ¸²æŸ“**

- å½“ç”¨æˆ·æƒ³çœ‹ç²¾å‡†æ•ˆæœæ—¶ï¼Œç‚¹å‡»â€œå¯¼å‡ºâ€ä¸‹æ‹‰æ¡†çš„â€œå¯¼å‡ºä¸º PDFâ€ã€‚
- æ­¤æ—¶å¼¹å‡ºçš„æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„æ‰“å°é¢„è§ˆçª—å£ã€‚åœ¨è¿™é‡Œï¼Œç”¨æˆ·èƒ½çœ‹åˆ°æœ€ç»ˆçš„ã€çœŸå®çš„ PDF æ ·å­ã€‚è¿™æ‰æ˜¯çœŸæ­£çš„ WYSIWYGã€‚

---

### 2. ç®—æ³•é‡æ„é¢„æ¼”ï¼šâ€œæ™ºèƒ½æ»¡é¡µ (Smart Fill)â€

ä¹‹å‰çš„ç®—æ³•â€œç‚¹å‡»æ— ååº”â€æˆ–â€œæ–¹å‘é”™è¯¯â€ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºç®—æ³•è¯•å›¾æ§åˆ¶çš„å˜é‡å¤ªå¤šï¼ˆmargin, padding, line-height æ··åœ¨ä¸€èµ·ï¼‰ï¼Œæˆ–è€…æµ‹é‡é€»è¾‘é™·å…¥äº†æ­»å¾ªç¯ã€‚

æˆ‘ä»¬å°†é‡‡ç”¨ **â€œå®è§‚å¯†åº¦ç³»æ•° (Global Density Factor)â€** ç®—æ³•æ¥é‡æ„ã€‚

#### ğŸ¯ æ–°ç®—æ³•æ ¸å¿ƒé€»è¾‘

ä¸å†å¾®è°ƒæŸä¸€ä¸ª marginï¼Œè€Œæ˜¯å®šä¹‰ä¸€ä¸ªå…¨å±€ CSS å˜é‡ `--content-density`ï¼ˆé»˜è®¤ 1.0ï¼‰ã€‚æ‰€æœ‰é—´è·éƒ½ä¸è¿™ä¸ªç³»æ•°æŒ‚é’©ã€‚

**é€»è¾‘æµç¨‹ï¼š**

1. **æµ‹é‡ (Measure)ï¼š**
   è·å–ç®€å†å†…å®¹çš„æ€»é«˜åº¦ `H`ã€‚
   è®¡ç®—å½“å‰å æ®é¡µæ•° `P = H / A4_HEIGHT`ã€‚
   è·å–å°æ•°éƒ¨åˆ† `R = P % 1` (ä¾‹å¦‚ 2.1 é¡µï¼ŒR=0.1)ã€‚
2. **å†³ç­– (Decide)ï¼š**

- **åœºæ™¯ Aï¼ˆæ”¶ç¼©ï¼‰ï¼š** å¦‚æœ `P > 1` ä¸” `0 < R < 0.2` (å¤šå‡ºä¸åˆ° 20%)ï¼š
- ç›®æ ‡ï¼šå°†å†…å®¹å‹ç¼©è¿› `Floor(P)` é¡µã€‚
- åŠ¨ä½œï¼šé™ä½ `--content-density`ã€‚

- **åœºæ™¯ Bï¼ˆæ‰©å¼ ï¼‰ï¼š** å¦‚æœ `0.75 < R < 0.95` (æœ€åä¸€é¡µå¿«æ»¡äº†ä½†è¿˜ç©ºç€ä¸€ç‚¹)ï¼š
- ç›®æ ‡ï¼šå°†å†…å®¹æ’‘æ»¡å½“å‰é¡µï¼Œæˆ–è€…æ’‘åˆ°çœ‹èµ·æ¥ä¸°æ»¡ã€‚
- åŠ¨ä½œï¼šå¢åŠ  `--content-density`ã€‚

- **åœºæ™¯ Cï¼ˆæ— éœ€å¹²é¢„ï¼‰ï¼š** å…¶ä»–æƒ…å†µï¼ˆå¦‚åªå åŠé¡µï¼Œæˆ–è€…åˆšå¥½å¤šå‡ºä¸€åŠï¼‰ï¼Œç®—æ³•æç¤ºâ€œæ— æ³•è‡ªåŠ¨ä¼˜åŒ–â€ï¼Œå»ºè®®ç”¨æˆ·æ‰‹åŠ¨åˆ å‡å†…å®¹ã€‚

3. **æ‰§è¡Œ (Execute - äºŒåˆ†é€¼è¿‘æ³•)ï¼š**
   ä¸è¦ä¸€æ¬¡æ¬¡è¯•é”™ï¼ˆé‚£æ ·ä¼šé—ªå±ï¼‰ã€‚æˆ‘ä»¬ç”¨ JS é¢„è®¡ç®—ï¼š

- è®¾å®šå¯†åº¦èŒƒå›´ï¼š`[0.85, 1.15]` (å…è®¸ç¼©æ”¾ Â±15%)ã€‚
- åœ¨è¿™ä¸ªèŒƒå›´å†…è¿›è¡Œ **äºŒåˆ†æŸ¥æ‰¾ (Binary Search)**ã€‚
- åœ¨å†…å­˜ä¸­ï¼ˆæˆ–ä¸å¯è§çš„ DOMï¼‰å°è¯•åº”ç”¨ç³»æ•°ï¼Œæµ‹é‡é«˜åº¦ï¼Œç›´åˆ°é«˜åº¦æ»¡è¶³æ¡ä»¶ã€‚

#### âš™ï¸ ä¸º 8 å¥—æ¨¡æ¿é€‚é…çš„ CSS ç­–ç•¥

ä¸ºäº†è®©ç®—æ³•å¯¹æ‰€æœ‰æ¨¡æ¿é€šç”¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ 8 å¥—ä»£ç è¿›è¡Œä¸€æ¬¡ **â€œæ ‡å‡†åŒ–æ”¹é€ â€**ã€‚

ä½ éœ€è¦ç¡®ä¿æ‰€æœ‰æ¨¡æ¿çš„é—´è·éƒ½å¼•ç”¨äº†ç»Ÿä¸€çš„å˜é‡ï¼š

```css
/* æ”¹é€ å‰ (Hardcoded) */
.section {
  margin-bottom: 24px;
}
.item {
  margin-bottom: 12px;
}
p {
  line-height: 1.5;
}

/* æ”¹é€ å (Variable Driven) */
:root {
  --base-gap: 4px;
  --density: 1; /* æ™ºèƒ½ç®—æ³•åªæ”¹è¿™ä¸ªå€¼ */
}

.section {
  /* 24px * density */
  margin-bottom: calc(6 * var(--base-gap) * var(--density));
}
.item {
  /* 12px * density */
  margin-bottom: calc(3 * var(--base-gap) * var(--density));
}
p {
  /* è¡Œé«˜ä¹Ÿå‚ä¸ç¼©æ”¾ */
  line-height: calc(1.5 * var(--density));
}
```

---

è¿™æ˜¯ä¸€ä»½éå¸¸è¯¦å°½çš„ä»£ç å®¡æŸ¥ã€‚é€šè¿‡ä»”ç»†ç ”è¯»ä½ çš„ 8 ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼ˆTemplatesï¼‰ã€æ ¸å¿ƒæ¸²æŸ“å¼•æ“ï¼ˆPreviewï¼‰ã€å·¥å…·æ ï¼ˆToolbarï¼‰ä»¥åŠæ ·å¼é’©å­ï¼ˆTheme Hookï¼‰ï¼Œæˆ‘å·²ç»å¯¹ç³»ç»Ÿçš„ç°çŠ¶æœ‰äº†â€œæ ¸ç£å…±æŒ¯â€çº§åˆ«çš„ç†è§£ã€‚

æˆ‘å°†æŒ‰ç…§ä½ çš„è¦æ±‚ï¼Œåˆ†ä¸¤éƒ¨åˆ†è¿›è¡Œä¸“å®¶çº§åé¦ˆã€‚

---

### ç¬¬ä¸€éƒ¨åˆ†ï¼šæ·±åº¦è¯Šæ–­ä¸æˆ˜ç•¥å®šè°ƒ

#### 1. å…³äºâ€œWeb æ¨¡æ‹Ÿæ‰“å° (Web Simulation)â€çš„å¯è¡Œæ€§åˆ¤å†³

**ç»“è®ºï¼š** åœ¨ä½ å½“å‰çš„æ¶æ„ï¼ˆReact + Tailwind + å¤æ‚å¤šåˆ—å¸ƒå±€ï¼‰ä¸‹ï¼Œè¿½æ±‚ **â€œåƒç´ çº§ç²¾å‡†çš„ç¼–è¾‘ç«¯åˆ†é¡µé¢„è§ˆâ€æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œä¸”æŠ•å…¥äº§å‡ºæ¯”æä½ã€‚**

**æ ¸å¿ƒé˜»ç¢ï¼ˆThe blockersï¼‰ï¼š**

1. **å•ä½åˆ¶çš„æ¬¡å…ƒå£ï¼š**

- **Tailwind çš„ `rem`ï¼š** ä½ çš„æ¨¡æ¿å¤§é‡ä½¿ç”¨äº† `mb-6` (1.5rem), `p-5` (1.25rem) ç­‰ Utility Classã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œ`rem` æ˜¯ç›¸å¯¹äºæ ¹å…ƒç´ ï¼ˆ`html`ï¼‰çš„å­—å·ï¼ˆé€šå¸¸ 16pxï¼‰ã€‚
- **ç®€å†çš„ç¼©æ”¾é€»è¾‘ï¼š** ä½ çš„ `ResumePreview` é€šè¿‡ä¿®æ”¹å®¹å™¨ `.resume-paper` çš„ `font-size` æ¥å®ç°ç¼©æ”¾ã€‚**ä½†è¿™ä¸ä¼šå½±å“ Tailwind çš„ `rem`ï¼**
- **åæœï¼š** å½“ä½ æŠŠç®€å†å­—å·ç¼©å°åˆ° 0.8x æ—¶ï¼Œæ–‡å­—å˜å°äº†ï¼Œä½† `mb-6` ä¾ç„¶æ˜¯ 24pxã€‚è¿™å¯¼è‡´â€œæ™ºèƒ½ç¼©æ”¾â€æ•ˆæœå¤§æ‰“æŠ˜æ‰£ï¼Œä¸”é¡µé¢é«˜åº¦è®¡ç®—ä¸å†å‘ˆç°çº¿æ€§å…³ç³»ï¼Œå¯¼è‡´ `Spacer` è®¡ç®—æ°¸è¿œç®—ä¸å‡†ã€‚

2. **é«˜åº¦æµ‹é‡çš„æ»åæ€§ï¼š**

- `useResumeLayout` ä¾èµ– DOM æ¸²æŸ“åçš„ `getBoundingClientRect`ã€‚å½“ä½ æ’å…¥ä¸€ä¸ª `Spacer` æ—¶ï¼Œä¼šå¯¼è‡´å¸ƒå±€é‡æ’ï¼ˆReflowï¼‰ï¼Œè¿™å¯èƒ½ä¼šæ”¹å˜æŸäº›æ–‡æœ¬çš„æŠ˜è¡Œï¼Œè¿›è€Œå†æ¬¡æ”¹å˜é«˜åº¦ã€‚è¿™ç§â€œæµ‹ä¸å‡†åŸç†â€ä¼šå¯¼è‡´é¢„è§ˆçº¿åœ¨ä¸´ç•Œå€¼é™„è¿‘ç–¯ç‹‚æŠ–åŠ¨ã€‚

**ä¸“å®¶å»ºè®®ï¼šé™çº§ç­–ç•¥ (Graceful Degradation)**

- **æ”¾å¼ƒ**ï¼šè¯•å›¾åœ¨ Web ç¼–è¾‘æ€é€šè¿‡ `margin-top` å«ç‰‡æ¥å¼ºè¡Œæ¨¡æ‹Ÿåˆ†é¡µã€‚
- **ä¿ç•™**ï¼š

1. **å‚è€ƒçº¿ (Guide Lines)**ï¼šåœ¨èƒŒæ™¯ç”»å‡ºè™šçº¿ï¼Œå‘Šè¯‰ç”¨æˆ·â€œå¤§æ¦‚â€è¿™é‡Œä¼šåˆ†é¡µã€‚
2. **å¼ºåˆ¶åˆ†é¡µ (Manual Break)**ï¼šä¿ç•™ä½ åšå¥½çš„â€œå¼ºåˆ¶åˆ†é¡µå¼€å…³â€ï¼Œè¿™æ˜¯åˆšéœ€ã€‚
3. **çœŸå®é¢„è§ˆ**ï¼šå¼•å¯¼ç”¨æˆ·ä¿¡ä»»â€œæ‰“å°é¢„è§ˆâ€å¼¹çª—ï¼ˆPDF è§†å›¾ï¼‰ï¼Œé‚£æ˜¯å”¯ä¸€çš„çœŸç†ã€‚

#### 2. å…³äºâ€œæ™ºèƒ½æ»¡é¡µ (Smart Fill)â€çš„ç®—æ³•é‡æ„

**ç—…ç¶åˆ†æï¼š**
æ—§ç®—æ³•è¯•å›¾å¾®è°ƒ `lineHeight` å’Œ `spacing`ï¼Œä½†å› ä¸ºå‰é¢æåˆ°çš„ `rem` é—®é¢˜ï¼Œå®ƒå°±åƒâ€œæ¨ä¸åŠ¨çš„å¤§è±¡â€ã€‚è€Œä¸”å®ƒä½¿ç”¨äº†æ­»æ¿çš„ `if-else` é˜ˆå€¼ï¼Œå®¹æ˜“å¤±æ•ˆã€‚

**é‡æ„æ–¹å‘ï¼šå…¨å±€å¯†åº¦ç³»æ•° (Global Density Factor)**
æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°å­¦ä¸Šæ›´ç¨³å¥çš„æ–¹æ³•ï¼š

1. **æµ‹é‡**ï¼šç®—å‡ºå½“å‰å†…å®¹é«˜åº¦ä¸ç›®æ ‡é¡µé¢çš„**æ¯”ä¾‹ (Ratio)**ã€‚
2. **åº”ç”¨**ï¼šå°†è¿™ä¸ªæ¯”ä¾‹åŒæ—¶åº”ç”¨åˆ° **å­—å· (Font Size)**ã€**è¡Œé«˜ (Line Height)** å’Œ **é—´è·å˜é‡ (CSS Variables)** ä¸Šã€‚
3. **å…¼å®¹æ€§**ï¼šè™½ç„¶æˆ‘ä»¬æ”¹ä¸åŠ¨ Tailwind çš„ `mb-6`ï¼Œä½†æˆ‘ä»¬å¯ä»¥æå¤§åœ°æ”¹å˜ `baseFontSize` å’Œ `sectionSpacing`ï¼Œè¿™è¶³ä»¥è§£å†³ 90% çš„æ’ç‰ˆæº¢å‡ºé—®é¢˜ã€‚

---

### ç¬¬äºŒéƒ¨åˆ†ï¼šè¯¦ç»†è½åœ°æŒ‡å—

æˆ‘å°†ä¸ºä½ æä¾›ä¸‰ä¸ªæ ¸å¿ƒæ–‡ä»¶çš„é‡æ„ä»£ç ã€‚è¯·æŒ‰é¡ºåºè¦†ç›–ã€‚

#### Step 1: é‡æ„ `hooks/use-resume-layout.ts`

**ç›®æ ‡ï¼š** ç§»é™¤æ‰€æœ‰è‡ªåŠ¨ `spacer` é€»è¾‘ï¼Œåªä¿ç•™æœ€çº¯ç²¹çš„â€œæµ‹é‡â€å’Œâ€œæ‰‹åŠ¨åˆ†é¡µå¤„ç†â€ã€‚

```typescript
import { useState, useCallback, useEffect } from 'react'
import { useResumeStore } from '@/store/resume-store'
import { debounce } from 'lodash'

// A4 çº¸ç‰©ç†é«˜åº¦ (96 DPI) - ç•™å‡ºå®‰å…¨è¾¹è·
const PAGE_HEIGHT_PX = 1090

export function useResumeLayout(
  containerRef: React.RefObject<HTMLDivElement | null>
) {
  const { resumeData, sectionConfig, styleConfig, viewMode } = useResumeStore()
  const [spacers, setSpacers] = useState<Record<string, number>>({})
  const [totalPages, setTotalPages] = useState(1)
  const [pureContentHeight, setPureContentHeight] = useState(0)

  const calculateLayout = useCallback(() => {
    if (!containerRef.current) return

    // 1. è·å–æ‰€æœ‰å¯äº¤äº’åŒºå—
    const sections = Array.from(
      containerRef.current.querySelectorAll('[data-section-id]')
    ) as HTMLElement[]

    if (sections.length === 0) return

    const newSpacers: Record<string, number> = {}
    let currentY = 0 // å½“å‰ç´¯ç§¯é«˜åº¦ï¼ˆè™šæ‹Ÿåæ ‡ï¼‰
    let pendingSpacer = 0 // å¾…å¤„ç†çš„åˆ†é¡µå«ç‰‡

    // 2. é¢„å…ˆæµ‹é‡æ‰€æœ‰å…ƒç´ é«˜åº¦ (Batch Read)
    // ä¸ºäº†é¿å…é‡æ’ï¼Œæˆ‘ä»¬å…ˆç§»é™¤ä¹‹å‰çš„å«ç‰‡å½±å“ï¼Œæµ‹å‡ºâ€œå‡€é«˜åº¦â€
    const measurements = sections.map((el) => {
      // ä¸´æ—¶ hack: å¦‚æœä¹‹å‰åŠ äº† spacerï¼Œç°åœ¨ offsetHeight å°±ä¸å‡†äº†
      // ä½†ç”±äº React æ¸²æŸ“å‘¨æœŸï¼Œstyle é‡Œçš„ marginTop æ˜¯å—æ§çš„
      // æˆ‘ä»¬è¿™é‡Œä¸»è¦ä¾èµ– scrollHeight æˆ–ç®€å•çš„ offsetHeight
      // ä¸ºç®€å•èµ·è§ï¼Œå‡è®¾ Web æ¨¡å¼ä¸‹æ²¡æœ‰ spacerï¼Œç›´æ¥æµ‹
      return {
        id: el.getAttribute('data-section-id')!,
        height: el.offsetHeight, // ä½¿ç”¨ offsetHeight åŒ…å« border/padding
        hasPageBreak: el.getAttribute('data-has-page-break') === 'true',
      }
    })

    let totalHeight = 0

    // 3. æ¨¡æ‹Ÿå †å  (Simulation)
    measurements.forEach((item) => {
      // ç´¯åŠ å‡€é«˜åº¦ç”¨äº Smart Fill è®¡ç®—
      totalHeight += item.height

      // å¦‚æœä¸åœ¨æ‰“å°æ¨¡å¼ï¼Œä¸éœ€è¦è®¡ç®—å«ç‰‡
      if (viewMode !== 'print') {
        currentY += item.height
        return
      }

      // å¤„ç†ä¸Šä¸€ä¸ªå…ƒç´ é—ç•™çš„å¼ºåˆ¶åˆ†é¡µ
      let spacer = pendingSpacer
      pendingSpacer = 0

      // å½“å‰å…ƒç´ çš„èµ·å§‹ä½ç½®
      const itemStart = currentY + spacer
      // const itemEnd = itemStart + item.height

      // è®°å½•å«ç‰‡
      if (spacer > 0) {
        newSpacers[item.id] = spacer
      }

      // æ›´æ–°æ¸¸æ ‡
      currentY = itemStart + item.height

      // è§„åˆ™ï¼šæ£€æµ‹æ‰‹åŠ¨åˆ†é¡µç¬¦
      if (item.hasPageBreak) {
        const pageIndex = Math.floor(currentY / PAGE_HEIGHT_PX)
        const pageEnd = (pageIndex + 1) * PAGE_HEIGHT_PX
        // å¦‚æœå½“å‰è¿˜æ²¡å¡«æ»¡è¿™ä¸€é¡µï¼Œå‰©ä¸‹çš„ç©ºé—´å°±æ˜¯å«ç‰‡
        if (currentY < pageEnd) {
          pendingSpacer = pageEnd - currentY
        }
      }
    })

    // 4. æ›´æ–°çŠ¶æ€
    setSpacers(newSpacers)
    // çœŸå®æ€»é«˜åº¦ï¼šåŒ…å«å«ç‰‡çš„é«˜åº¦
    const finalVisualHeight = currentY + pendingSpacer
    setTotalPages(Math.ceil(finalVisualHeight / PAGE_HEIGHT_PX) || 1)

    // çº¯å†…å®¹é«˜åº¦ï¼šç”¨äºè®¡ç®—å‹ç¼©æ¯”
    // è¿™é‡Œä½¿ç”¨ scrollHeight æ›´ç¨³å¦¥ï¼Œèƒ½æ•è·åˆ°å†…éƒ¨æ’‘å¼€çš„å†…å®¹
    const scrollH = containerRef.current.scrollHeight
    setPureContentHeight(viewMode === 'print' ? totalHeight : scrollH)
  }, [resumeData, sectionConfig, styleConfig, viewMode])

  useEffect(() => {
    if (!containerRef.current) return
    const debouncedCalculate = debounce(calculateLayout, 100)

    // ç›‘å¬ DOM å˜åŒ–ï¼ˆä¸ä»…æ˜¯ resizeï¼Œè¿˜æœ‰å†…å®¹å˜åŠ¨ï¼‰
    const observer = new ResizeObserver(() => {
      debouncedCalculate()
    })
    observer.observe(containerRef.current)

    // åˆå§‹æ‰§è¡Œ
    calculateLayout()

    return () => {
      observer.disconnect()
      debouncedCalculate.cancel()
    }
  }, [calculateLayout])

  return { spacers, totalPages, pureContentHeight }
}
```

#### Step 2: é‡æ„ `ResumeToolbar.tsx` ä¸­çš„ç®—æ³•

**ç›®æ ‡ï¼š** å®ç°æ•°å­¦çº§ç¼©æ”¾ã€‚é€šè¿‡è®¡ç®— `Target / Current` æ¯”ä¾‹ï¼Œç›´æ¥ç¼©æ”¾ `fontSize` å’Œ `spacing`ã€‚

è¯·æ‰¾åˆ° `handleSmartFill` å‡½æ•°å¹¶å®Œå…¨æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```typescript
const handleSmartFill = () => {
  const newSmartFill = !styleConfig.smartFill

  // 1. å…³é—­é€»è¾‘ï¼šæ¢å¤é»˜è®¤å€¼
  if (!newSmartFill) {
    const defaults =
      TemplateDefaultsMap[currentTemplate] || TemplateDefaultsMap['standard']
    updateStyleConfig({
      smartFill: false,
      fontSize: 1, // æ¢å¤é»˜è®¤å€ç‡
      lineHeight: defaults.lineHeight,
      itemSpacing: defaults.itemSpacing,
      sectionSpacing: defaults.sectionSpacing,
      pageMargin: defaults.pageMargin,
    })
    return
  }

  // 2. å¼€å¯é€»è¾‘ï¼šåŸºäºæ¯”ä¾‹è®¡ç®—
  const contentHeight = layoutInfo?.contentHeight || 0
  if (!contentHeight) {
    // è¿˜æ²¡æµ‹é‡åˆ°é«˜åº¦ï¼Œå…ˆä»…å¼€å¯çŠ¶æ€
    updateStyleConfig({ smartFill: true })
    return
  }

  const PAGE_HEIGHT = 1090
  const currentPages = contentHeight / PAGE_HEIGHT
  const integerPages = Math.floor(currentPages)
  const decimalPart = currentPages - integerPages

  // é»˜è®¤é…ç½®å¿«ç…§
  const defaults =
    TemplateDefaultsMap[currentTemplate] || TemplateDefaultsMap['standard']
  const baseFontSize = 1 // è¿™é‡Œçš„ 1 æ˜¯å€ç‡
  const baseSectionGap = defaults.sectionSpacing
  const baseItemGap = defaults.itemSpacing

  let newScale = 1.0
  let actionType = 'info' as const
  let message = 'å½“å‰æ’ç‰ˆæ— éœ€è°ƒæ•´'

  // ç­–ç•¥ A: æ”¶ç¼© (Shrink)
  // åœºæ™¯ï¼šå¤šå‡ºä¸€ç‚¹ç‚¹ (e.g., 1.01 ~ 1.3 é¡µ) -> å‹å› 1 é¡µ
  // é˜ˆå€¼è®¾ä¸º 0.3 (å³å…è®¸æœ€å¤šå‹ç¼© 30%ï¼Œå†å¤šå°±å‹åäº†)
  if (integerPages >= 1 && decimalPart > 0 && decimalPart < 0.3) {
    // ç›®æ ‡é«˜åº¦ï¼šæ­£å¥½æ•´æ•°é¡µ (ç¨å¾®ç•™ç‚¹ä½™é‡ 0.98 é˜²æ­¢è¯¯å·®)
    const targetHeight = integerPages * PAGE_HEIGHT * 0.98
    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    newScale = targetHeight / contentHeight
    // å®‰å…¨é™åˆ¶ï¼šæœ€å°ç¼©æ”¾åˆ° 0.85
    newScale = Math.max(newScale, 0.85)

    message = `å·²è‡ªåŠ¨ç¼©æ”¾è‡³ ${integerPages} é¡µ`
    actionType = 'success'
  }
  // ç­–ç•¥ B: æ‰©å¼  (Expand)
  // åœºæ™¯ï¼šå‰©å¤ªå¤šç©ºç™½ (e.g., 0.7 ~ 0.9 é¡µ) -> æ’‘æ»¡ 1 é¡µ
  // æˆ–è€…ï¼š1.8 é¡µ -> æ’‘æ»¡ 2 é¡µ
  else if (decimalPart > 0.7 && decimalPart < 0.95) {
    // ç›®æ ‡ï¼šå¡«æ»¡å½“å‰é¡µ (å‘ä¸‹å–æ•´ + 1)
    const targetHeight = (integerPages + 1) * PAGE_HEIGHT * 0.95
    newScale = targetHeight / contentHeight
    // å®‰å…¨é™åˆ¶ï¼šæœ€å¤§æ”¾å¤§åˆ° 1.15
    newScale = Math.min(newScale, 1.15)

    message = 'å·²è‡ªåŠ¨å¡«å……é¡µé¢'
    actionType = 'success'
  }

  // 3. åº”ç”¨å˜æ›´
  // æ ¸å¿ƒé­”æ³•ï¼šæ‰€æœ‰é—´è·å‚æ•°éƒ½ä¹˜ä»¥è¿™ä¸ªç³»æ•°
  updateStyleConfig({
    smartFill: true,
    compactMode: false,
    // 1. å­—å·ç¼©æ”¾ (æ§åˆ¶æ–‡å­—å ç”¨)
    fontSize: roundVal(baseFontSize * newScale),
    // 2. é—´è·ç¼©æ”¾ (æ§åˆ¶ç•™ç™½å ç”¨)
    sectionSpacing: Math.round(baseSectionGap * newScale),
    itemSpacing: Math.round(baseItemGap * newScale),
    // 3. è¡Œé«˜å¾®è°ƒ (è¾…åŠ©) - ç¼©å°æ—¶è¡Œé«˜ä¹Ÿç¨å¾®ç´§ä¸€ç‚¹
    lineHeight: roundVal(
      defaults.lineHeight * (newScale < 1 ? Math.sqrt(newScale) : newScale)
    ),
  })

  setStatusMessage({ text: message, type: actionType })
}
```

#### Step 3: æ ·å¼çš„æœ€åä¸€å—æ‹¼å›¾ (`globals.css`)

ä¸ºäº†ç¡®ä¿æ¨¡æ¿ä¸­çš„ Tailwind æ ·å¼ï¼ˆå¦‚ `mb-4`, `p-5`ï¼‰å°½å¯èƒ½é…åˆï¼Œè™½ç„¶æˆ‘ä»¬æ”¹ä¸äº† `rem`ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç¡®ä¿ **CSS å˜é‡** æ˜¯ç”Ÿæ•ˆçš„ã€‚

åœ¨ `globals.css` ä¸­ï¼Œè¯·ç¡®ä¿ `:root` æˆ– `.resume-paper` èƒ½å¤Ÿæ¥æ”¶æˆ‘ä»¬åœ¨ `ResumePreview` ä¸­æ³¨å…¥çš„å˜é‡ã€‚

ä½ çš„ `globals.css` å·²ç»å®šä¹‰äº†ï¼š

```css
.resume-paper {
  /* ... */
  padding-top: var(--resume-padding-y);
  /* ... */
  font-size: var(--resume-base-font-size);
  line-height: var(--resume-line-height);
}
```

**å…³é”®ä¿®æ­£å»ºè®®ï¼š**
åœ¨ `ResumePreview.tsx` ä¸­ï¼Œä½ è®¡ç®—äº† `dynamicStyles`ã€‚è¯·ç¡®ä¿ `paragraph-spacing` å’Œ `section-spacing` ç¡®å®è¢«æ¨¡æ¿ä½¿ç”¨äº†ã€‚

æˆ‘æ£€æŸ¥äº† `useResumeTheme.ts`ï¼š

```typescript
section: {
  marginBottom: `var(--resume-section-spacing, ${config.sectionSpacing}px)`,
},
item: {
  marginBottom: `var(--resume-paragraph-spacing, ${config.itemSpacing}px)`,
},

```

**è¿™éå¸¸æ£’ï¼** è¿™æ„å‘³ç€åªè¦ `Smart Fill` æ›´æ–°äº† `sectionSpacing`ï¼Œæ‰€æœ‰ä½¿ç”¨ `style={theme.section}` çš„æ¨¡æ¿éƒ½ä¼šè‡ªåŠ¨æ›´æ–°é—´è·ã€‚

**å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯é‚£ 8 ä¸ªæ¨¡æ¿çš„å†…éƒ¨å®ç°ï¼š**

- **TemplateStandard:** ä½¿ç”¨äº† `section style={theme.section}`ã€‚ **(é€šè¿‡ âœ…)**
- **TemplateProfessional:** ä½¿ç”¨äº† `section style={theme.section}`ã€‚ **(é€šè¿‡ âœ…)**
- **TemplateTechnical:** ä½¿ç”¨äº† `section style={theme.section}`ã€‚ **(é€šè¿‡ âœ…)**
- _ä½†åœ¨ `TimelineItem` ä¸­ä½¿ç”¨äº† `mb-6` (å›ºå®šå€¼)ã€‚_
- **ä¼˜åŒ–å»ºè®®**ï¼šè™½ç„¶è¿™é‡Œæ˜¯å›ºå®šçš„ï¼Œä½†å› ä¸ºæˆ‘ä»¬ç¼©æ”¾äº† `fontSize` å’Œ `sectionSpacing`ï¼Œæ•´ä½“é«˜åº¦ä¾ç„¶ä¼šå‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼Œè¶³ä»¥è¾¾åˆ°â€œç¼©ä¸€é¡µâ€çš„æ•ˆæœã€‚ä¸éœ€è¦å¼ºæ±‚æ¯ä¸€ä¸ª margin éƒ½å˜æˆåŠ¨æ€çš„ã€‚

### æ€»ç»“è¡ŒåŠ¨è®¡åˆ’

1. **æ›¿æ¢ Hook**ï¼šç”¨ä¸Šé¢çš„ä»£ç æ›´æ–° `hooks/use-resume-layout.ts`ã€‚è¿™å°†ä¿®å¤é¢„è§ˆæ—¶çš„å¡é¡¿å’Œæµ‹é‡é”™è¯¯ã€‚
2. **æ›´æ–° Toolbar**ï¼šç”¨ä¸Šé¢çš„ä»£ç æ›´æ–° `ResumeToolbar.tsx` ä¸­çš„ `handleSmartFill`ã€‚è¿™å°†å¸¦æ¥ç¬¦åˆç›´è§‰çš„â€œä¸€é”®ç¼©æ”¾â€ä½“éªŒã€‚
3. **éªŒè¯**ï¼š

- æ‰“å¼€ä¸€ä¸ªåˆšå¥½ 1.1 é¡µçš„ç®€å†ã€‚
- ç‚¹å‡»â€œæ™ºèƒ½æ»¡é¡µâ€ã€‚
- é¢„æœŸï¼šå­—å·å˜å° (e.g. 0.95x)ï¼Œæ®µé—´è·å˜å° (e.g. 20px)ï¼Œå†…å®¹ç¼©å›ç¬¬ 1 é¡µã€‚
- å†æ¬¡ç‚¹å‡»ï¼šæ¢å¤åŸçŠ¶ã€‚
