# 问题描述

我正在优化关于 job_match 的 prompt（M9 的核心 LLM 输出）

当前使用的 prompt template 在附件 1~2 中，重点看 job_match 部分；而 prompt input & llm output 示例，可参考附件 3

其实当前的模型返回质量属于及格线以上，回答的质量算是 ok、能点对点作出匹配和建议，输出的 json 格式也比较稳定

但如果切换到 HR/猎头的第一人称视角来看，有一些属于真实业务场景中大概率存在、却没有写在 JD 上的“潜规则”，当前 prompt 并没有很好地覆盖到，譬如：

1）岗位 JD 里的要求描述有很多，但其中是有优先级之分的，这些并不会明确地写到 JD 里；更有甚者，有的 HR 为了省事，往往把大而全的岗位需求描述都扔到 JD 里，并没有真的很明确该岗位所需的核心技能与经验是什么

2）HR/猎头在 JD 扔出去后，每天在求职平台上会收到大量的求职者私信接触，往往都是千篇一律、或者是平台预设好的“戳一戳”模板，因此，他们对机械化的问询话术早就免疫了，往往真人化、真诚的表达，才更有可能实现触达的效果

3）当然还有很多这样的场景化思考，不能全部一一列举，你可以再补充下比较典型的 case

对于这些藏在 JD 细节里、以及 HR/猎头日常工作中的“默契”，我们有什么办法可以精准地捕抓到、并合理融入到 prompt 中，让 LLM 能够把更有实战效果、更能打的分析结果给到求职者用户呢？

请你作为求职/招聘领域专家 & AI Prompt 专家，帮忙深入思考，并给出解题方案。在当前 job_match prompt template 的基础上，提出进一步精准优化细节，请分别给出中/英文版本

# 解题思路

这是一个非常敏锐且切中痛点的观察。你从“功能可用”跨越到了“业务好用”的层面。

现在的 Prompt 就像一个\*\*“应届生优等生”\*\*：它认真做题，字面匹配，格式完美，但不懂“社会语境”和“潜规则”。

要让 LLM 变成一个\*\*“老练的猎头/职场军师”**，我们需要在 Prompt 中注入**“隐性知识（Tacit Knowledge）”\*\*。

以下是我的深度分析和重构方案。

---

### 一、 深度分析：还有哪些“潜规则”被遗漏？

除了你提到的“JD 优先级模糊”和“打招呼话术机械”之外，真实的招聘漏斗中还有以下典型场景（我们将这些融入 Prompt 策略中）：

1.  **“过度胜任”风险（Over-qualified Risk）**：

    - **场景**：求职者是资深架构师，投递了一个中级开发岗。
    - **现状**：普通 Prompt 会给 100 分（技能全覆盖）。
    - **HR 视角**：这是“高危”简历。他是不是来养老的？是不是过渡一下马上就跑？工资能不能谈拢？
    - **策略**：Prompt 需识别“能力溢出”，并在 `weaknesses` 或 `suggestions` 中提示用户“你需要解释为什么愿意低就，以消除稳定性顾虑”。

2.  **“业务痛点” vs “技能列表”**：

    - **场景**：JD 写“精通 Excel、Python”。
    - **现状**：LLM 匹配技能点。
    - **HR 视角**：我招人是为了解决“销售数据混乱，没人能出报表”的问题。
    - **策略**：Prompt 需让 LLM 脑补该岗位背后的**业务场景**。在话术中，不要说“我会 Python”，要说“我能用 Python 自动化处理销售数据，节省团队 50% 时间”。

3.  **“硬伤”识别（Deal Breakers）**：

    - **场景**：JD 写“本科以上”，求职者“大专”。JD 写“必须有金融背景”，求职者“纯互联网”。
    - **现状**：LLM 可能会因为其他技能匹配度高，给出一个 80 分。
    - **HR 视角**：学历/行业门槛通常是硬指标，不达标直接 Pass。
    - **策略**：引入“红线机制”。如果核心硬性条件（学历、年限、特定行业）不符，分数必须大幅打折。

---

### 二、 优化思路：Prompt Engineering 策略

我们将对 `job_match` 的 prompt 做如下手术：

1.  **角色升级 (Persona Refinement)**：

    - 从“求职助手”升级为 **“拥有 20 年经验的招聘专家和职业策略顾问”**。赋予它洞察 JD 潜台词的权限。

2.  **思维链注入 (CoT - Chain of Thought)**：

    - 在进行匹配前，要求模型先在内部（或逻辑上）执行 **“JD 解码”**：区分 _Must-have (刚需)_ 和 _Nice-to-have (锦上添花)_，识别 _Generic Fluff (废话)_。

3.  **话术革命 (Outreach Renovation)**：

    - 明确禁止“废话文学”（如 "I hope this email finds you well" / "我对贵司很感兴趣"）。
    - 强制使用 **"Hook Strategy"（钩子策略）**：价值前置 + 痛点打击。

---

### 三、 落地代码：优化后的 Prompt Template

请将以下代码更新至 `lib/prompts/zh.ts` 和 `lib/prompts/en.ts`。

#### 1\. 中文版本 (`lib/prompts/zh.ts`)

我重新编写了 `job_match` 部分，增加了由于“潜规则”所需的具体指令。

```typescript
// lib/prompts/zh.ts

// ... (SYSTEM_BASE 保持不变)

export const PROMPTS_ZH: PromptTemplateMap = {
  // ... 其他 prompt

  // --- 核心业务：岗位匹配度分析 (M9) ---
  job_match: {
    id: 'job_match',
    name: '岗位匹配度深度分析',
    description:
      '模拟资深猎头视角，分析简历与JD的深层匹配度，并生成高转化话术。',
    systemPrompt: `你是一位拥有20年经验的**资深招聘专家和职业策略顾问**。你深知企业招聘的“潜规则”，能看透 JD 背后真实的业务痛点。
你的目标不是简单的关键词匹配，而是判断求职者能否真正胜任并“拿下”该 Offer。

核心分析逻辑：
1.  **JD 解码（去伪存真）**：
    - 识别 JD 中的“硬指标”（学历、核心技能、行业年限）——这是红线，不达标则分数大幅降低。
    - 识别 JD 中的“核心痛点”（这个岗位招进来究竟是为了解决什么问题？）。
    - 忽略 HR 复制粘贴的“正确的废话”（如笼统的沟通能力强、抗压能力强），除非有具体场景佐证。

2.  **匹配度评分机制**：
    - **高度匹配 (85-100)**：核心硬指标达标 + 解决了核心业务痛点 + 这种人才是市面上稀缺的。
    - **中度匹配 (60-84)**：核心技能达标，但缺乏特定行业经验或软技能证据；或者存在“过度胜任（Over-qualified）”的稳定性风险。
    - **存在挑战 (<60)**：硬指标（如学历、必须的硬技能）缺失，即使其他方面很优秀。

3.  **话术生成策略（拒绝机械化）**：
    - **场景**：这是发送给 HR/猎头的**第一条私信** (Cold DM)。
    - **原则**：HR 每天看几百条私信，必须在前 20 个字抓住眼球。
    - **禁忌**：严禁使用“您好，我对贵司很感兴趣”、“希望能给我一个机会”等卑微或废话开场。
    - **公式**：**钩子(Hook)** + **价值闭环(Value Loop)**。
    - **写法**：直接点出你能解决什么问题。例如：“我在类似场景下用 [方案 X] 提升了 30% 效率，这似乎正是您 JD 中提到的痛点...”`,

    userPrompt: `请基于以下材料进行专家级匹配度分析：

【岗位 JD (结构化)】
"""
{{job_summary_json}}
"""

【候选人简历 (结构化)】
"""
{{resume_summary_json}}
"""

【候选人详细履历 (可选参考)】
"""
{{detailed_resume_summary_json}}
"""

【RAG 知识库 (规则/范式)】
"""
{{rag_context}}
"""

请执行以下步骤并返回 JSON：

1.  **match_score (0-100)**: 基于上述“专家逻辑”打分。如果存在硬性红线（如学历、核心硬技能）不符，分数不得超过 60。
2.  **overall_assessment**: 用简练、犀利的专家口吻评价。不要只说好话，要指出风险（如：跳槽频繁、过度胜任、行业跨度大）。
3.  **strengths / weaknesses**:
    - **Point**: 必须具体。
    - **Evidence**: 必须引用简历中的具体数据或项目（不要只说“经验丰富”，要说“在xx项目处理过千万级并发”）。
    - *注意*：如果是“过度胜任”，请将其列为 weakness 的潜在风险（HR 会担心留不住人）。
4.  **cover_letter_script (私信话术)**:
    - 长度：100-150 字以内。
    - 风格：专业、自信、平视（Partner 姿态，而非 Beggar 姿态）。
    - 内容：不要覆盖所有技能。**只挑选 1-2 个最能击中该 JD 痛点的“杀手锏”进行展示。**
    - 格式：分段清晰，方便阅读。

严格遵循 Output Schema 输出 JSON。`,
    variables: [
      'job_summary_json',
      'resume_summary_json',
      'detailed_resume_summary_json',
      'rag_context',
    ],
    outputSchema: {
      // 保持现有的 Schema 结构，但在 prompt 中我们重新定义了字段的内涵
      type: 'object',
      properties: {
        match_score: { type: 'number', description: '0-100的匹配分数' },
        overall_assessment: {
          type: 'string',
          description: '简短犀利的综合评价',
        },
        strengths: {
          type: 'array',
          items: {
            type: 'object',
            properties: {
              point: { type: 'string' },
              evidence: { type: 'string' },
              section: { type: 'string' },
            },
            required: ['point', 'evidence'],
          },
        },
        weaknesses: {
          type: 'array',
          items: {
            type: 'object',
            properties: {
              point: { type: 'string' },
              evidence: { type: 'string' },
              section: { type: 'string' },
            },
            required: ['point', 'evidence'],
          },
        },
        cover_letter_script: {
          type: 'string',
          description: '高转化率的私信/招呼语（非传统求职信）',
        },
        recommendations: { type: 'array', items: { type: 'string' } },
      },
      required: [
        'match_score',
        'overall_assessment',
        'strengths',
        'weaknesses',
        'cover_letter_script',
      ],
    } as JsonSchema,
  },
}
```

#### 2\. 英文版本 (`lib/prompts/en.ts`)

英文版同样需要强调 Tone (Tone of Voice) 和 Recruitment Psychology。

```typescript
// lib/prompts/en.ts

// ... (SYSTEM_BASE remains)

export const PROMPTS_EN: PromptTemplateMap = {
  // ... other prompts

  // --- Core Business: Job Match Analysis (M9) ---
  job_match: {
    id: 'job_match',
    name: 'Deep Job Match Analysis',
    description:
      'Simulates a senior recruiter perspective to analyze fit and generate high-conversion outreach scripts.',
    systemPrompt: `You are an **Ex-Fortune 500 Recruiter and Career Strategist** with 20 years of experience. You understand the "unspoken rules" of hiring and can decode the true business pain points behind a JD.
Your goal is not simple keyword matching, but determining if the candidate can truly "win" the offer.

Core Analysis Logic:
1.  **JD Decoding (Cut through the noise)**:
    - Identify "Deal Breakers" (Education, Specific Hard Skills, YOE in specific industries). If these are missing, the score must drop significantly.
    - Identify the "Core Pain Point" (Why is this role open? What problem needs solving?).
    - Ignore generic fluff (e.g., "Good communication skills") unless backed by specific scenario requirements.

2.  **Scoring Mechanism**:
    - **High Match (85-100)**: Deal breakers met + Solves Core Pain Point + Scarce talent profile.
    - **Medium Match (60-84)**: Hard skills met, but lacks specific industry context or soft skill evidence; OR indicates "Over-qualified" risk (flight risk).
    - **Challenging (<60)**: Missing hard requirements (Education, Essential Tech Stack), even if the candidate is otherwise excellent.

3.  **Outreach Script Strategy (No Robots)**:
    - **Scenario**: This is a **Cold DM / Direct Message** to a recruiter/hiring manager.
    - **Principle**: Recruiters skim messages. You must grab attention in the first sentence.
    - **Forbidden**: Do NOT use "I hope this email finds you well," "I am interested in your company," or generic pleasantries.
    - **Formula**: **The Hook** (Relevance) + **The Value Prop** (Evidence) + **Call to Action**.
    - **Tone**: Professional, Confident, Peer-to-Peer (Not subordinate).`,

    userPrompt: `Please perform an expert-level match analysis based on the following:

【Job Description (Structured)】
"""
{{job_summary_json}}
"""

【Candidate Resume (Structured)】
"""
{{resume_summary_json}}
"""

【Candidate Detailed History (Optional)】
"""
{{detailed_resume_summary_json}}
"""

【RAG Context (Rules/Examples)】
"""
{{rag_context}}
"""

Execute the following steps and return strictly JSON:

1.  **match_score (0-100)**: Score based on the "Recruiter Logic" above. Penalize heavily for missing "Deal Breakers".
2.  **overall_assessment**: Short, sharp, expert evaluation. Don't just be nice; point out risks (e.g., "Job hopping history," "Over-qualified," "Industry mismatch").
3.  **strengths / weaknesses**:
    - **Point**: Be specific.
    - **Evidence**: Quote specific metrics or projects from the resume (e.g., "Handled 1M+ concurrency" instead of "Good backend skills").
    - *Note*: If "Over-qualified", list this as a potential weakness (risk of retention).
4.  **cover_letter_script**:
    - Length: Under 150 words.
    - Style: A high-conversion **Cold DM / Elevator Pitch**.
    - Content: Do not list all skills. **Pick the top 1-2 "Killer Features" that solve the JD's specific pain point.**
    - Format: Clean paragraph(s), easy to read on mobile.

Strictly follow the Output Schema.`,
    variables: [
      'job_summary_json',
      'resume_summary_json',
      'detailed_resume_summary_json',
      'rag_context',
    ],
    outputSchema: {
      // Keeping schema structure compatible
      type: 'object',
      properties: {
        match_score: { type: 'number', description: '0-100 Score' },
        overall_assessment: {
          type: 'string',
          description: 'Concise, sharp expert assessment',
        },
        strengths: {
          type: 'array',
          items: {
            type: 'object',
            properties: {
              point: { type: 'string' },
              evidence: { type: 'string' },
              section: { type: 'string' },
            },
            required: ['point', 'evidence'],
          },
        },
        weaknesses: {
          type: 'array',
          items: {
            type: 'object',
            properties: {
              point: { type: 'string' },
              evidence: { type: 'string' },
              section: { type: 'string' },
            },
            required: ['point', 'evidence'],
          },
        },
        cover_letter_script: {
          type: 'string',
          description: 'High-conversion Cold DM/Outreach script',
        },
        recommendations: { type: 'array', items: { type: 'string' } },
      },
      required: [
        'match_score',
        'overall_assessment',
        'strengths',
        'weaknesses',
        'cover_letter_script',
      ],
    } as JsonSchema,
  },
}
```

### 四、 关键改动点总结 (Key Changes)

| 功能点       | 原 Prompt (Before)        | 优化后 Prompt (After)                    | 预期效果                                               |
| :----------- | :------------------------ | :--------------------------------------- | :----------------------------------------------------- |
| **角色设定** | 资深求职助手              | **资深招聘专家 & 职业策略顾问**          | 视角从“帮用户说话”转变为“帮用户看清现实”。             |
| **JD 分析**  | 依赖关键词匹配            | **JD 解码** (区分硬指标/废话/核心痛点)   | 避免因为匹配了次要关键词（如 Word）而虚高分数。        |
| **话术风格** | 传统求职信 (Cover Letter) | **钩子策略 (Cold DM Hook)**              | 输出更像真人的私信，第一句话就能抓住 HR 痛点。         |
| **风险识别** | 主要看技能缺失            | **包含“过度胜任”、“跳槽频繁”等隐性风险** | 给出更真实的反馈，让用户知道为什么自己被拒。           |
| **语气**     | 客观、平铺直叙            | **犀利、平视、专业**                     | 让用户感觉是花钱请了专家，而不是在用免费的聊天机器人。 |

这样的 Prompt 设计，能在不修改后端代码和数据库 Schema 的前提下，显著提升产品体验的“智商”和“情商”。
