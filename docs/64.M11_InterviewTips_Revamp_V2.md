# Implementation Plan
# M11: Interview Tips å½»åº•é‡æ„ â€” å¼€å‘è“å›¾ V2

> **å®šä½**ï¼šç»™ç”¨æˆ·ä¸€ä»½"å¼€å·è€ƒè¯•çš„ç­”æ¡ˆ" â€” ä¸æ˜¯æ³›æ³›çš„é¢è¯•æŒ‡å¯¼ï¼Œè€Œæ˜¯åŸºäºå…¶ä¸ªäººç®€å†èµ„äº§ Ã— ç›®æ ‡å²—ä½ JD é«˜åº¦å®šåˆ¶çš„"é¢è¯•ä½œæˆ˜æ‰‹å¡"

---

## ä¸€ã€ç°çŠ¶åˆ†æä¸é—®é¢˜è¯Šæ–­

### 1.1 å½“å‰å®ç°æ¶æ„

```mermaid
flowchart LR
    subgraph "Step 1: åŒ¹é…åº¦åˆ†æ"
        JD["JD åŸæ–‡/æˆªå›¾"]
        Resume["é€šç”¨ç®€å†"]
        DetailedResume["è¯¦ç»†å±¥å†(å¯é€‰)"]
        JD --> JobSummary["job_summary_json"]
        Resume --> ResumeSummary["resume_summary_json"]
        DetailedResume --> DetailedSummary["detailed_summary_json"]
        JobSummary --> Match["match_summary_json"]
        ResumeSummary --> Match
    end
    
    subgraph "Step 2: ç®€å†å®šåˆ¶"
        Match --> Customize["customized_resume_json"]
        ResumeSummary --> Customize
        DetailedSummary --> Customize
    end
    
    subgraph "Step 3: é¢è¯•å‡†å¤‡(å½“å‰)"
        JobSummary --> InterviewCurrent["interview_tips_json"]
    end
    
    style InterviewCurrent fill:#f96,stroke:#f00,stroke-width:2px
```

### 1.2 å…³é”®ä»£ç ä½ç½®

| å±‚çº§ | æ–‡ä»¶è·¯å¾„ | å…³é”®å‡½æ•°/ç»„ä»¶ |
|------|----------|---------------|
| **Prompt æ¨¡æ¿** | [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts#L490-L531) | `interview_prep` æ¨¡æ¿å®šä¹‰ |
| **Output Schema** | [schemas.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/schemas.ts#L482-L524) | `SCHEMAS.INTERVIEW_PREP` |
| **æ‰§è¡Œå™¨** | [executor.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/executor.ts#L238-L320) | [executeInterviewPrep()](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#188-249) |
| **ä¸šåŠ¡é€»è¾‘** | [business-logic.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts) | `BusinessLogicService.executeInterviewPrep()` |
| **DAL** | [services.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts) | [ensureInterviewRecord()](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#97-104), [setInterviewTipsJson()](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#242-252) |
| **Worker å¤„ç†** | [handlers.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/worker/handlers.ts) | Interview ä»»åŠ¡å®Œæˆå¤„ç† |
| **Prisma Schema** | [schema.prisma](file:///Users/edisonmbli/Projects/CareerShaper/prisma/schema.prisma#L162-L173) | [Interview](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#52-61) æ¨¡å‹ |

### 1.3 å½“å‰å®ç°çš„è‡´å‘½ç¼ºé™·

> [!CAUTION]
> å½“å‰ [executeInterviewPrep()](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#188-249) å‡ ä¹ä¼ é€’äº†**ç©ºä¸Šä¸‹æ–‡**ï¼

```typescript
// lib/prompts/executor.ts L252-262 â€” å½“å‰å®ç°
const res = await runLlmTask(
  'interview_prep',
  DEFAULT_LOCALE,
  {
    rag_context: '',                    // âŒ ç©º
    customized_resume_md: '',           // âŒ ç©º â€” å…³é”®é—æ¼ï¼
    job_summary_json: jobSummaryJson,   // âœ… æœ‰
    match_analysis_json: '',            // âŒ ç©º â€” å…³é”®é—æ¼ï¼
  },
  ...
)
```

**åæœ**ï¼š
1. **æ— æ³•åˆ©ç”¨ Step 1/2 çš„æ•°æ®èµ„äº§** â€” ä¸¢å¤±äº†åŒ¹é…åº¦åˆ†æä¸­çš„ strengths/weaknesses/recommendations
2. **è¾“å‡ºå†…å®¹ä¸ç”¨æˆ·ç®€å†è„±èŠ‚** â€” LLM åªèƒ½åŸºäº JD æ³›æ³›è€Œè°ˆ
3. **æ— æ³•ç”Ÿæˆé’ˆå¯¹æ€§çš„é˜²å¾¡è¯æœ¯** â€” ä¸çŸ¥é“ç”¨æˆ·çš„å…·ä½“çŸ­æ¿æ˜¯ä»€ä¹ˆ

### 1.4 å½“å‰ Output Schema å±€é™æ€§

```typescript
// lib/prompts/schemas.ts L482-524 â€” å½“å‰ INTERVIEW_PREP Schema
{
  self_introduction_script: string,     // ä»… 1 åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»
  potential_questions: [{               // 5-7 ä¸ªé«˜é¢‘é—®é¢˜
    question: string,
    answer_guideline: string,
  }],
  reverse_questions: string[],          // 3 ä¸ªåé—®é—®é¢˜
}
```

**å±€é™**ï¼š
- ç¼ºå°‘**æƒ…æŠ¥é€è§†**æ¨¡å—ï¼ˆé¢è¯•å®˜è§†è§’çš„ä¸šåŠ¡ç—›ç‚¹è§£è¯»ï¼‰
- ç¼ºå°‘**STAR æ•…äº‹**æ¨¡å—ï¼ˆåŸºäºç”¨æˆ·çœŸå®ç»å†çš„è¯æ®é“¾ï¼‰
- ç¼ºå°‘**æ”»é˜²æ¼”ç»ƒ**æ¨¡å—ï¼ˆé’ˆå¯¹ç”¨æˆ·å¼±ç‚¹çš„é˜²å¾¡è¯æœ¯ï¼‰

---

## äºŒã€ç›®æ ‡ä¸è®¾è®¡åŸåˆ™

### 2.1 æ ¸å¿ƒç›®æ ‡

```
è®©ç”¨æˆ·åœ¨é¢è¯•å‰ 30 åˆ†é’Ÿå†…ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¶ˆåŒ–ä¸€ä»½ é«˜åº¦ä¸ªäººåŒ– çš„å¤‡å¿˜å½•ï¼Œ
åšåˆ° "å¿ƒä¸­æœ‰æ•°ã€å˜´ä¸Šæœ‰è¯ã€æ‰‹é‡Œæœ‰è´§"ã€‚
```

### 2.2 è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ä¸Šä¸‹æ–‡ä¸²è”** | å¿…é¡»å……åˆ†åˆ©ç”¨ Step 1/2 å·²æ²‰æ·€çš„æ•°æ®èµ„äº§ |
| **ç”Ÿæˆå¼æ–‡æ¡£** | ä¸€æ¬¡æ€§ Batch ç”Ÿæˆï¼Œè€Œéå¯¹è¯å¼ |
| **æ‰“å­—æœºåŠ¨æ•ˆ** | è™½æ˜¯ Batch ç”Ÿæˆï¼ŒUI è¾“å‡ºæ—¶å¤ç”¨ M9 çš„æ‰“å­—æœºåŠ¨æ•ˆå¢å¼ºäº’åŠ¨æ„Ÿ |
| **ç»“æ„åŒ–å‘ˆç°** | ç”¨ UI ç»„ä»¶åˆ†æ¨¡å—å±•ç¤º |
| **å·¥å…·å±æ€§** | æä¾›å¯å¤åˆ¶ã€å¯æ‰“å°çš„å®ç”¨å†…å®¹ |

### 2.3 å·®å¼‚åŒ–æŠ¤åŸæ²³

```mermaid
graph TD
    A["é€šç”¨ AI + ç®€å• Prompt"] --> B["60åˆ†: æ³›æ³›çš„é¢è¯•å»ºè®®"]
    C["CareerShaper Interview Tips"] --> D["95åˆ†: åŸºäºä¸ªäººå±¥å† Ã— JD çš„ç²¾å‡†ä½œæˆ˜æ‰‹å¡"]
    
    subgraph "æŠ¤åŸæ²³"
        E["Step 1: match_analysis"]
        F["Step 2: customized_resume"]
        G["ç”¨æˆ·ç®€å†/è¯¦å†èµ„äº§"]
        H["RAG çŸ¥è¯†åº“"]
    end
    
    E --> D
    F --> D
    G --> D
    H --> D
```

---

## ä¸‰ã€æ–°æ¶æ„è®¾è®¡

### 3.1 æ•°æ®æµé‡æ„

```mermaid
flowchart TB
    subgraph "è¾“å…¥å±‚ Context Injection"
        JD["job_summary_json"]
        Match["match_summary_json"]
        Resume["resume_summary_json"]
        Detailed["detailed_summary_json"]
        Customized["customized_resume_json"]
        RAG["RAG çŸ¥è¯†åº“"]
    end
    
    subgraph "LLM å¤„ç†"
        Prompt["interview_prep_v2 Prompt"]
    end
    
    subgraph "è¾“å‡ºå±‚ Interview Battle Plan"
        M1["æ¨¡å—1: æƒ…æŠ¥é€è§† Radar"]
        M2["æ¨¡å—2: å¼€åœºå®šè°ƒ Hook"]
        M3["æ¨¡å—3: æ ¸å¿ƒè®ºæ® Evidence"]
        M4["æ¨¡å—4: æ”»é˜²æ¼”ç»ƒ Defense"]
        M5["æ¨¡å—5: åé—®åˆ©å™¨ Reverse"]
    end
    
    JD --> Prompt
    Match --> Prompt
    Resume --> Prompt
    Detailed --> Prompt
    Customized --> Prompt
    RAG --> Prompt
    
    Prompt --> M1
    Prompt --> M2
    Prompt --> M3
    Prompt --> M4
    Prompt --> M5
```

### 3.2 æ–° Output Schema è®¾è®¡

```typescript
// æ–°ç‰ˆ INTERVIEW_PREP_V2 Schema
{
  // æ¨¡å—1: æƒ…æŠ¥é€è§†
  radar: {
    core_challenges: [{ challenge, why_important, your_angle }],
    interviewer_persona: string,
    hidden_requirements: string[],
  },
  
  // æ¨¡å—2: å¼€åœºå®šè°ƒ
  hook: {
    ppf_script: string,
    key_hooks: [{ hook, evidence_source }],
    delivery_tips: string[],
  },
  
  // æ¨¡å—3: æ ¸å¿ƒè®ºæ® â€” 3 ä¸ª STAR æ•…äº‹
  evidence: [{
    story_title: string,
    matched_pain_point: string,
    star: { situation, task, action, result },
    quantified_impact: string,
    source: 'resume' | 'detailed_resume',
  }],
  
  // æ¨¡å—4: æ”»é˜²æ¼”ç»ƒ
  defense: [{
    weakness_point: string,
    likely_question: string,
    defense_script: string,
    pivot_to_strength: string,
  }],
  
  // æ¨¡å—5: åé—®åˆ©å™¨
  reverse_questions: [{
    question: string,
    intent: string,
    what_to_listen: string,
  }],
  
  // é™„åŠ : çŸ¥è¯†è¡¥è¯¾ï¼ˆå¯é€‰ï¼‰
  knowledge_refresh?: [{
    topic: string,
    key_points: string[],
    why_relevant: string,
  }],
}
```

---

## å››ã€Proposed Changes

### Phase 1: åç«¯æ ¸å¿ƒé‡æ„

---

#### [MODIFY] [schemas.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/schemas.ts)

æ–°å¢ `INTERVIEW_PREP_V2` Schemaï¼ŒåŒ…å« 5 ä¸ªæ ¸å¿ƒæ¨¡å—çš„å®Œæ•´ç±»å‹å®šä¹‰ã€‚

---

#### [MODIFY] [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts#L490-L531)

é‡å†™ `interview_prep` æ¨¡æ¿ï¼š

> [!NOTE]
> **æ¶æ„æ¾„æ¸…**ï¼š
> - `SYSTEM_BASE`ï¼ˆL7-23ï¼‰ï¼šæ‰€æœ‰ä»»åŠ¡å…±ç”¨çš„åŸºç¡€è§„åˆ™ï¼ˆJSON æ ¼å¼ã€è¯­è¨€å¤„ç†ç­‰ï¼‰
> - `systemPrompt`ï¼šä»»åŠ¡ç‰¹å®šçš„äººè®¾ + æ ¸å¿ƒç­–ç•¥ï¼ˆéµå¾ªç°æœ‰ `job_match` å’Œ `resume_customize` çš„æ¨¡å¼ï¼‰
> - `userPrompt`ï¼šä»»åŠ¡çº§åˆ«çš„å…·ä½“æ‰§è¡ŒæŒ‡ä»¤ï¼ˆåŒ…å«ä¸Šä¸‹æ–‡æ³¨å…¥å’Œæ€ç»´é“¾ï¼‰

**æ”¹åŠ¨å†…å®¹**ï¼š

**1. systemPromptï¼ˆä»»åŠ¡äººè®¾ï¼‰**ï¼š
```typescript
systemPrompt: `ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„**ç§äººé¢è¯•æ•™ç»ƒ**ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®åŠ©ç”¨æˆ·ç”Ÿæˆä¸€ä»½"é¢è¯•ä½œæˆ˜æ‰‹å¡"â€”â€”è¿™ä¸æ˜¯æ³›æ³›çš„å»ºè®®ï¼Œè€Œæ˜¯åŸºäºç”¨æˆ·çš„çœŸå®ç®€å†å’Œç›®æ ‡å²—ä½JDï¼Œç”Ÿæˆå¯ä»¥ç›´æ¥æ‹¿å»é¢è¯•ç”¨çš„"å¼€å·ç­”æ¡ˆ"ã€‚

### æ ¸å¿ƒåŸåˆ™
1. **é«˜åº¦ä¸ªäººåŒ–**ï¼šæ‰€æœ‰å†…å®¹å¿…é¡»å¼•ç”¨ç”¨æˆ·çš„çœŸå®ç»å†ï¼Œä¸¥ç¦å¥—è¯
2. **å¯æ‰§è¡Œæ€§**ï¼šæ¯ä¸ªè¯æœ¯éƒ½å¯ä»¥ç›´æ¥èƒŒè¯µä½¿ç”¨
3. **æ”»é˜²å…¼å¤‡**ï¼šæ—¢è¦æ”¾å¤§ä¼˜åŠ¿ï¼Œä¹Ÿè¦å‡†å¤‡å¼±ç‚¹é˜²å¾¡
4. **è¯æ®é“¾å®Œæ•´**ï¼šæ¯ä¸ªè®ºç‚¹éƒ½æœ‰ç®€å†ä¸­çš„å…·ä½“æ¡ˆä¾‹æ”¯æ’‘

### RAG çŸ¥è¯†åº“ä½¿ç”¨æŒ‡å¼•
- **é¢è¯•æŠ€å·§ (category=interview_strategies)**: ç”¨äºç”Ÿæˆ STAR æ•…äº‹ç»“æ„ã€é˜²å¾¡è¯æœ¯çš„æ ‡å‡†èŒƒå¼
- **è‡ªæˆ‘ä»‹ç» (category=self_introduction)**: ç”¨äºç”Ÿæˆ P-P-F ç»“æ„çš„è‡ªæˆ‘ä»‹ç»æ¨¡æ¿
- **å‚è€ƒæ¨¡å¼**: å‚ç…§ resume_customize prompt ä¸­çš„ RAG ä½¿ç”¨æ–¹å¼ï¼Œä»…ä½œä¸ºè¡¨è¾¾æŠ€å·§å‚è€ƒï¼Œä¸¥ç¦å°† RAG ç¤ºä¾‹ç›´æ¥å¥—ç”¨

${SYSTEM_BASE}`,
```

**2. userPromptï¼ˆæ‰§è¡ŒæŒ‡ä»¤ï¼‰**ï¼š
- æ³¨å…¥å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆ6 ä¸ªå˜é‡ï¼‰
- æ·»åŠ è¯¦ç»†çš„æ€ç»´é“¾ç”ŸæˆæŒ‡å¼•ï¼ˆ6 ä¸ª Stepï¼‰
- æ¯ä¸ªæ¨¡å—çš„ç”Ÿæˆè§„åˆ™

**3. variablesï¼ˆå˜é‡åˆ—è¡¨ï¼‰**ï¼š
```typescript
variables: [
  'job_summary_json',
  'match_analysis_json',           // æ–°å¢
  'customized_resume_json',        // æ–°å¢
  'resume_summary_json',
  'detailed_resume_summary_json',
  'rag_context',
],
```

**4. outputSchema**ï¼š
```typescript
outputSchema: SCHEMAS_V2.INTERVIEW_PREP_V2,  // æŒ‡å‘æ–° Schema
```

---

#### [MODIFY] [en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/en.ts)

åŒæ­¥è‹±æ–‡ç‰ˆ `interview_prep` æ¨¡æ¿æ”¹åŠ¨ã€‚

---

#### [MODIFY] [executor.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/executor.ts#L238-L320)

é‡æ„ [executeInterviewPrep()](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#188-249) å‡½æ•°ï¼š
- æ–°å¢ `matchAnalysisJson`, `customizedResumeJson` å‚æ•°
- ä¿®æ”¹ `runLlmTask` è°ƒç”¨å¡«å……å®Œæ•´ä¸Šä¸‹æ–‡
- æ›´æ–°è¾“å‡ºç±»å‹æ˜ å°„

---

#### [MODIFY] [services.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts)

æ–°å¢ `getInterviewContext(serviceId)` DAL å‡½æ•°ï¼Œè·å– Interview ä»»åŠ¡æ‰€éœ€çš„å®Œæ•´ä¸Šä¸‹æ–‡ã€‚

---

#### [MODIFY] [business-logic.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts)

ä¿®æ”¹ [executeInterviewPrep()](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#188-249) æ–¹æ³•ï¼Œè°ƒç”¨æ–° DAL å‡½æ•°è·å–å¹¶ä¼ é€’å®Œæ•´ä¸Šä¸‹æ–‡ã€‚

---

### Phase 2: å‰ç«¯ UI æ„å»º

> [!IMPORTANT]
> **è®¾è®¡ä¸€è‡´æ€§è¦æ±‚**:
> - ä¸ `ResultCard` ç»„ä»¶ï¼ˆåŒ¹é…åº¦åˆ†æç»“æœï¼‰çš„è§†è§‰é£æ ¼ä¿æŒä¸€è‡´
> - ä¸ `resume/editor` çš„ç®€å†å®šåˆ¶åŒ–å·¥å…·äº¤äº’æ¨¡å¼åè°ƒ
> - ç¡®ä¿ç”¨æˆ·åœ¨ Step 1 â†’ Step 2 â†’ Step 3 çš„ä½“éªŒé«˜åº¦è¿è´¯

> [!NOTE]
> **å“åº”å¼è®¾è®¡ä¼˜å…ˆçº§**: æ¡Œé¢ç«¯ä½¿ç”¨ä½“éªŒä¸ºä¸»ï¼Œå…¼é¡¾ç§»åŠ¨ç«¯å°å±æŸ¥çœ‹ä½“éªŒ

#### ä»»åŠ¡æ¸…å•

**æ–°å»ºæ–‡ä»¶**: `components/workbench/InterviewBattlePlan.tsx`

æ–°å»ºä¸»å®¹å™¨ç»„ä»¶ï¼Œåè°ƒ 5 ä¸ªæ¨¡å—çš„æ¸²æŸ“ã€‚

```typescript
// æ ¸å¿ƒç»„ä»¶ç»“æ„
export function InterviewBattlePlan({ data }: { data: InterviewPrepV2Data }) {
  // å¤ç”¨ M9 åŒ¹é…åº¦åˆ†æçš„æ‰“å­—æœºåŠ¨æ•ˆ
  const [displayedContent, setDisplayedContent] = useTypewriterEffect(data)
  
  return (
    <div className="space-y-4 print:space-y-2">
      {/* æ‰“å­—æœºæ¸è¿›å±•ç¤ºå„æ¨¡å— */}
      <RadarModule data={displayedContent.radar} />
      <HookModule data={displayedContent.hook} />
      <EvidenceModule data={displayedContent.evidence} />
      <DefenseModule data={displayedContent.defense} />
      <ReverseModule data={displayedContent.reverse_questions} />
      {displayedContent.knowledge_refresh && (
        <KnowledgeModule data={displayedContent.knowledge_refresh} />
      )}
      <ActionBar 
        onPrint={handlePrint}        // æ‰“å°è‡³çº¸è´¨é¡µé¢ï¼ˆçº¿ä¸‹æºå¸¦ï¼‰
        onCopyAll={handleCopyAll}    // å¤åˆ¶å…¨éƒ¨æ–‡æœ¬
        onRegenerate={handleRegenerate} 
        className="print:hidden"     // æ‰“å°æ—¶éšè—æ“ä½œæ 
      />
    </div>
  )
}
```

---

##### P2.2 å„æ¨¡å—å­ç»„ä»¶

- `RadarModule.tsx` â€” Accordion + Badgeï¼ˆä¿æŒä¸ ResultCard ä¸€è‡´çš„æŠ˜å äº¤äº’ï¼‰
- `HookModule.tsx` â€” å¸¦å¤åˆ¶æŒ‰é’®çš„ä»£ç å—æ ·å¼æ–‡æœ¬æ¡†
- `EvidenceModule.tsx` â€” Tab åˆ‡æ¢ 3 ä¸ª STAR æ•…äº‹å¡ç‰‡
- `DefenseModule.tsx` â€” æŠ˜å é¢æ¿ + é«˜äº®å¼±ç‚¹æ ‡ç­¾
- `ReverseModule.tsx` â€” ç®€æ´åˆ—è¡¨
- `PrintableLayout.tsx` â€” æ‰“å°ä¼˜åŒ–å¸ƒå±€ï¼ˆé€‚é… A4 çº¸å¼ ï¼Œä¼˜é›…æ’ç‰ˆï¼‰

---

#### [MODIFY] [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/zh.ts)

æ–°å¢ `interviewBattlePlan` å‘½åç©ºé—´çš„ä¸­æ–‡ç¿»è¯‘ï¼š

```typescript
interviewBattlePlan: {
  title: 'é¢è¯•ä½œæˆ˜æ‰‹å¡',
  radar: {
    title: 'æƒ…æŠ¥é€è§†',
    subtitle: 'é¢è¯•å®˜è§†è§’çš„ä¸šåŠ¡ç—›ç‚¹è§£è¯»',
  },
  hook: {
    title: 'å¼€åœºå®šè°ƒ',
    subtitle: '1 åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»',
    copyButton: 'å¤åˆ¶',
  },
  evidence: {
    title: 'æ ¸å¿ƒè®ºæ®',
    subtitle: 'STAR æ•…äº‹åº“',
  },
  defense: {
    title: 'æ”»é˜²æ¼”ç»ƒ',
    subtitle: 'å¼±ç‚¹é˜²å¾¡è¯æœ¯',
  },
  reverse: {
    title: 'åé—®åˆ©å™¨',
    subtitle: 'é«˜è´¨é‡åé—®',
  },
  actions: {
    print: 'æ‰“å°',
    printHint: 'ä¼˜åŒ–æ’ç‰ˆï¼Œé€‚é… A4 çº¸å¼ ',
    copyAll: 'å¤åˆ¶å…¨æ–‡',
    regenerate: 'é‡æ–°ç”Ÿæˆ',
  },
},
```

---

#### [MODIFY] [en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/en.ts)

æ–°å¢ `interviewBattlePlan` å‘½åç©ºé—´çš„è‹±æ–‡ç¿»è¯‘ã€‚

---

### Phase 3: ç«¯åˆ°ç«¯é›†æˆ

##### P3.1 è§¦å‘é€»è¾‘

> [!IMPORTANT]
> **è§¦å‘æ–¹å¼**: æ‰‹åŠ¨è§¦å‘ï¼ˆéè‡ªåŠ¨ï¼‰
> 
> **Tier æ£€æµ‹é€»è¾‘**:
> - æ ¹æ®ç”¨æˆ·å½“å‰ quota åˆ¤æ–­èµ° Free tier è¿˜æ˜¯ Paid tier
> - **Free tier**: ä½¿ç”¨åŸºç¡€æ¨¡å‹ï¼ˆå¦‚ gemini-flashï¼‰ï¼Œå…è´¹é˜Ÿåˆ—
> - **Paid tier**: ä½¿ç”¨æ›´å¼ºæ¨¡å‹ï¼ˆå¦‚ gpt-4o / claude-3.5-sonnetï¼‰ï¼Œä¸“å±é˜Ÿåˆ—ï¼Œæ‰£å‡æœåŠ¡é‡‘å¸
> - å‚è€ƒ `resume_customize` çš„ tier åˆ¤æ–­é€»è¾‘

- ç¡®è®¤ Interview Tips çš„è§¦å‘å…¥å£ï¼ˆStep 3 é¢æ¿çš„"ç”Ÿæˆé¢è¯•ä½œæˆ˜æ‰‹å¡"æŒ‰é’®ï¼‰
- ç¡®è®¤å‰ç½®æ¡ä»¶æ ¡éªŒï¼ˆStep 1 + Step 2 å¿…é¡»å®Œæˆï¼‰
- ç¡®è®¤é‡‘å¸æ‰£å‡é€»è¾‘ä¸é€€æ¬¾æœºåˆ¶
- ç¡®è®¤é‡‘å¸æ‰£å‡é€»è¾‘

#### SSE æµå¼åé¦ˆ

- å¤ç”¨ç°æœ‰ `StreamPanelV2` ç»„ä»¶
- æ–°å¢ Interview é˜¶æ®µçš„çŠ¶æ€æ–‡æ¡ˆ i18n

---

## äº”ã€Verification Plan

### Automated Tests

> [!NOTE]
> å½“å‰é¡¹ç›®æ— è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶é…ç½®ï¼Œä»¥ä¸‹éªŒè¯ä¾èµ–æ‰‹åŠ¨æµ‹è¯•ã€‚

#### 1. Schema éªŒè¯

```bash
# åœ¨ Node REPL ä¸­éªŒè¯æ–° Schema çš„ Zod ç±»å‹
cd /Users/edisonmbli/Projects/CareerShaper
node -e "
const { SCHEMAS } = require('./lib/prompts/schemas');
console.log('INTERVIEW_PREP_V2 exists:', !!SCHEMAS.INTERVIEW_PREP_V2);
console.log('Required fields:', SCHEMAS.INTERVIEW_PREP_V2?.required);
"
```

#### 2. Build éªŒè¯

```bash
cd /Users/edisonmbli/Projects/CareerShaper
pnpm build
# é¢„æœŸ: æ—  TypeScript é”™è¯¯
```

### Manual Verification

#### æ­¥éª¤ 1: åç«¯ LLM è¾“å‡ºéªŒè¯

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`pnpm dev`
2. ç™»å½•åº”ç”¨ï¼Œè¿›å…¥ä¸€ä¸ªå·²å®Œæˆ Step 1 + Step 2 çš„ Service
3. è§¦å‘ Step 3 Interview Tips ç”Ÿæˆ
4. åœ¨æµè§ˆå™¨ DevTools Network é¢æ¿æŸ¥çœ‹å“åº”
5. éªŒè¯å“åº” JSON åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
   - `radar.core_challenges[]`
   - `hook.ppf_script`
   - `evidence[]` (è‡³å°‘ 1 æ¡)
   - `defense[]` (è‡³å°‘ 1 æ¡)
   - `reverse_questions[]` (è‡³å°‘ 2 æ¡)

#### æ­¥éª¤ 2: å‰ç«¯ UI æ¸²æŸ“éªŒè¯

1. ç¡®è®¤ 5 ä¸ªæ¨¡å— Accordion æ­£ç¡®æŠ˜å /å±•å¼€
2. ç¡®è®¤"å¤åˆ¶"æŒ‰é’®æ­£å¸¸å·¥ä½œï¼ˆç‚¹å‡»åå‰ªè´´æ¿æœ‰å†…å®¹ï¼‰
3. ç¡®è®¤ä¸­è‹±æ–‡åˆ‡æ¢å i18n æ–‡æ¡ˆæ­£ç¡®
4. ç¡®è®¤ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€æ­£å¸¸

#### æ­¥éª¤ 3: ç«¯åˆ°ç«¯æµç¨‹éªŒè¯

1. åˆ›å»ºæ–° Serviceï¼Œä¸Šä¼  JD å’Œç®€å†
2. å®Œæˆ Step 1 åŒ¹é…åº¦åˆ†æ
3. å®Œæˆ Step 2 ç®€å†å®šåˆ¶
4. è¿›å…¥ Step 3ï¼Œè§¦å‘ Interview Tips ç”Ÿæˆ
5. éªŒè¯é‡‘å¸æ­£ç¡®æ‰£å‡ï¼ˆæŸ¥çœ‹å³ä¸Šè§’ä½™é¢æˆ–äº¤æ˜“è®°å½•ï¼‰
6. éªŒè¯ç”Ÿæˆå†…å®¹ä¸ç”¨æˆ·ç®€å†é«˜åº¦ç›¸å…³ï¼ˆå¼•ç”¨äº†ç”¨æˆ·çš„çœŸå®ç»å†ï¼‰

---

## å…­ã€é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| Token æˆæœ¬è¿‡é«˜ | å¤§ä¸Šä¸‹æ–‡å¯¼è‡´æˆæœ¬é£™å‡ | æŒ‰éœ€è£å‰ª detailed_resumeï¼ˆåªå– top 3 ç»å†ï¼‰ |
| LLM è¾“å‡ºä¸ç¨³å®š | è¾“å‡ºä¸ç¬¦åˆ Schema | ä½¿ç”¨ Structured Output + å¤šè½®é‡è¯• |
| ç”¨æˆ·ç®€å†å†…å®¹ä¸è¶³ | æ— æ³•ç”Ÿæˆé«˜è´¨é‡ STAR æ•…äº‹ | æç¤ºç”¨æˆ·"å»ºè®®ä¸Šä¼ è¯¦ç»†å±¥å†" |

---

## ä¸ƒã€æˆåŠŸæŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| åŠŸèƒ½å®Œæˆåº¦ | 5 ä¸ªæ ¸å¿ƒæ¨¡å—å…¨éƒ¨ä¸Šçº¿ | ä»£ç  Review |
| ç”ŸæˆæˆåŠŸç‡ | > 95% | LLM æ—¥å¿—ç›‘æ§ |
| ç”¨æˆ·ä½¿ç”¨ç‡ | Step 2 å®Œæˆç”¨æˆ·ä¸­ > 60% ç»§ç»­ä½¿ç”¨ Step 3 | Analytics Event |

---

## å…«ã€å‚è€ƒæ–‡æ¡£

- [çœŸå®é¢è¯•å‡†å¤‡æ¡ˆä¾‹](file:///Users/edisonmbli/Projects/CareerShaper/docs/62.Interview_Prep_Example.md) â€” 582 è¡Œçš„çœŸå®è¿­ä»£è¿‡ç¨‹
- [V1 æ–¹æ¡ˆè‰ç¨¿](file:///Users/edisonmbli/Projects/CareerShaper/docs/63.M11_InterviewTips_Revamp_V1.md) â€” æ ¸å¿ƒæ€è·¯æ¥æº


# M11: Interview Tips é‡æ„ â€” Task Tracker

> **ç›®æ ‡**: å°† Interview Tips ä»"åŠæˆå“"å‡çº§ä¸ºåŸºäº Step 1/2 æ•°æ®èµ„äº§çš„é«˜åº¦ä¸ªäººåŒ–"é¢è¯•ä½œæˆ˜æ‰‹å¡"

---

## Phase 1: åç«¯æ¶æ„å‡çº§ [x]

### P1.1 Schema è®¾è®¡ [x]

- [x] ä¿®æ”¹ [lib/prompts/schemas.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/schemas.ts)
- [x] æ–°å¢ `INTERVIEW_PREP_V2` schema
- [x] ä¿ç•™ `INTERVIEW_PREP` (legacy) å‘åå…¼å®¹

### P1.2 Prompt é‡å†™ [x]

- [x] æ›´æ–° [lib/prompts/zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts) - interview_prep
- [x] æ›´æ–° [lib/prompts/en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/en.ts) - interview_prep

### P1.3 Executor å±‚é‡æ„ [x]

- [x] ä¿®æ”¹ `lib/services/executors/interview_prep.ts` (executor.ts)
- [x] æ¥å—æ–°å‚æ•°: `matchAnalysisJson`, `customizedResumeJson`
- [x] è°ƒç”¨ `runLlmTask` æ—¶ä¼ å…¥6ä¸ªä¸Šä¸‹æ–‡å˜é‡

### P1.4 Data Access Layer (DAL) [x]

- [x] æ–°å¢ [lib/dal/services.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts) â†’ [getInterviewContext](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#253-314) å‡½æ•°
- [x] å¯¼å‡ºä» [lib/dal/index.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/index.ts)

### P1.5 Business Logic Layer [x]

- [x] ä¿®æ”¹ [lib/services/business-logic.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts) â†’ [executeInterviewPrep](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#188-249)
- [x] è°ƒç”¨ [getInterviewContext](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#253-314) è·å–5ä¸ªä¸Šä¸‹æ–‡
- [x] ä¼ é€’ç»™ executor

### P1.6 Code Review ä¿®å¤ [x]

- [x] ç»Ÿä¸€ prompt æ ¼å¼ (```json â†’ """)
- [x] é‡æ–°è®¾è®¡ radar æ¨¡å— (å•ä¸€é¢è¯•å®˜ â†’ å¤šè½®é¢è¯•é“¾è·¯)

---

## Phase 2: å‰ç«¯ UI æ„å»º [/]

### P2.1 ç»„ä»¶æ¶æ„ [x]

- [x] åˆ›å»º `components/workbench/interview/` ç›®å½•
- [x] `InterviewBattlePlan.tsx` (æ ¹å®¹å™¨)
  - [x] Action Bar (æ‰“å°/å¤åˆ¶/é‡æ–°ç”Ÿæˆ)
  - [x] é›†æˆ 5 ä¸ªå­æ¨¡å—
  - [x] ä¸ ResultCard ä¸€è‡´çš„è§†è§‰é£æ ¼

### P2.2 5 ä¸ªåŠŸèƒ½æ¨¡å— [x]

- [x] `RadarModule.tsx` (æƒ…æŠ¥é€è§†)
  - [x] Accordion UI (æ ¸å¿ƒæŒ‘æˆ˜/é¢è¯•é“¾è·¯/éšè—è¦æ±‚)
  - [x] æ”¯æŒå¤šè½®é¢è¯•æ˜¾ç¤º
  - [x] âœ¨ è®¾è®¡ç²¾ç‚¼ï¼šM9 é£æ ¼ (ç°åº¦ç³»ç»Ÿ + é»„è‰²æ ‡é¢˜)
- [x] `HookModule.tsx` (å¼€åœºå®šè°ƒ)
  - [x] P-P-F è„šæœ¬æ˜¾ç¤º
  - [x] å¤åˆ¶åŠŸèƒ½
  - [x] å…³é”®é’©å­ + æ¼”è®²æŠ€å·§
  - [x] âœ¨ è®¾è®¡ç²¾ç‚¼ï¼šç®€æ´è¾¹æ¡† + å…‹åˆ¶é…è‰²
- [x] `EvidenceModule.tsx` (æ ¸å¿ƒè®ºæ®)
  - [x] Tabs åˆ‡æ¢ 3 ä¸ª STAR æ•…äº‹
  - [x] S-T-A-R ç»“æ„åŒ–å±•ç¤º
  - [x] âœ¨ è®¾è®¡ç²¾ç‚¼ï¼šç»Ÿä¸€ç°åº¦ + Grid å¸ƒå±€
- [x] `DefenseModule.tsx` (æ”»é˜²æ¼”ç»ƒ)
  - [x] Accordion å±•ç¤ºå¼±ç‚¹é˜²å¾¡
  - [x] é¢„åˆ¤è¿½é—® + é˜²å¾¡è¯æœ¯
  - [x] âœ¨ è®¾è®¡ç²¾ç‚¼ï¼šè¾¹æ¡†å±‚çº§åŒºåˆ†
- [x] `ReverseModule.tsx` (åé—®åˆ©å™¨)
  - [x] åé—®é¢˜åˆ—è¡¨
  - [x] æé—®æ„å›¾ + å€¾å¬é‡ç‚¹
  - [x] âœ¨ **ä¼˜åŒ–ä¸º Server Component**ï¼ˆç§»é™¤ 'use client'ï¼‰
  - [x] âœ¨ è®¾è®¡ç²¾ç‚¼ï¼šTimeline å¸ƒå±€ + ç¼–å·æ ‡è®°
  - [x] âœ¨ **åŠ¨æ€ä¸»é¢˜è‰²**ï¼šæ”¯æŒ emerald/amber/rose


### P2.2.1 åŠ¨æ€ä¸»é¢˜è‰²ç³»ç»Ÿ [x]

- [x] æ ¹æ®åŒ¹é…åº¦åˆ†æ•°åŠ¨æ€é€‰æ‹©ä¸»é¢˜è‰²
  - [x] â‰¥85: emerald (ç»¿è‰²ï¼Œé«˜åº¦åŒ¹é…)
  - [x] 60-84: amber (é»„è‰²ï¼Œè‰¯å¥½å¥‘åˆ)
  - [x] <60: rose (çº¢è‰²ï¼Œéœ€æ”¹è¿›)
- [x] InterviewBattlePlan æ–°å¢ `matchScore` prop (é»˜è®¤85)
- [x] æ‰€æœ‰å­æ¨¡å—æ”¯æŒ `themeColor` prop
- [x] Section æ ‡é¢˜èƒŒæ™¯è‰²åŠ¨æ€æ¸²æŸ“
- [x] ä¸ ResultCard çš„ `getThemeColor` é€»è¾‘ä¿æŒä¸€è‡´


### P2.3 i18n æ”¯æŒ [x]

- [x] ä¿®æ”¹ `lib/i18n/zh.ts` æ–°å¢ `interviewBattlePlan` å‘½åç©ºé—´
  - [x] radar æ¨¡å—æ–‡æ¡ˆ
  - [x] hook æ¨¡å—æ–‡æ¡ˆ
  - [x] evidence æ¨¡å—æ–‡æ¡ˆ
  - [x] defense æ¨¡å—æ–‡æ¡ˆ
  - [x] reverse æ¨¡å—æ–‡æ¡ˆ
  - [x] actions æ–‡æ¡ˆ

- [x] åŒæ­¥ä¿®æ”¹ `lib/i18n/en.ts` è‹±æ–‡ç‰ˆ

---

## Phase 3: ç«¯åˆ°ç«¯é›†æˆ [x]

### P3.1 è§¦å‘é€»è¾‘ [x]

- [x] âœ… Step 3 è§¦å‘å…¥å£å·²å­˜åœ¨ (`doInterview` + `onInterview`)
- [x] âœ… Tier æ£€æµ‹é€»è¾‘å·²å®ç° (`interviewGuard` + Free tier ç¡®è®¤å¯¹è¯æ¡†)
- [x] âœ… å‰ç½®æ¡ä»¶æ ¡éªŒï¼ˆStep 1 å¿…é¡»å®Œæˆï¼‰
- [x] âœ… é‡‘å¸æ‰£å‡é€»è¾‘ï¼ˆServer Action ä¸­å·²å¤„ç†ï¼‰
- [x] âœ… Interview Tab æ¸²æŸ“
  - [x] InterviewBattlePlan ç»„ä»¶é›†æˆ
  - [x] PENDING/FAILED/COMPLETED çŠ¶æ€å¤„ç†
  - [x] matchScore ä¼ é€’

### P3.2 SSE æµå¼åé¦ˆ [x]

- [x] æ–°å¢ Interview é˜¶æ®µçš„çŠ¶æ€æ–‡æ¡ˆ i18n
  - [x] INTERVIEW_PENDING / INTERVIEW_PENDING_DESC (zh.ts + en.ts)
  - [x] INTERVIEW_STREAMING (zh.ts + en.ts)
  - [x] INTERVIEW_COMPLETED (zh.ts + en.ts)
  - [x] INTERVIEW_FAILED / INTERVIEW_FAILED_DESC (zh.ts + en.ts)

### P3.3 é”™è¯¯å¤„ç† [x]

- [x] âœ… å¤ç”¨ç°æœ‰é”™è¯¯é‡è¯•æœºåˆ¶ (å·²ç¡®è®¤ handleGuardFailure, recordRefund, InterviewStrategy)
- [x] âœ… é‡‘å¸é€€è¿˜é€»è¾‘éªŒè¯ (recordRefund + markDebitFailed)
- [x] âœ… å¤±è´¥çŠ¶æ€ UI å±•ç¤º (BatchProgressPanel with retry button)

---

## Phase 4: æ‰“ç£¨ä¸ä¼˜åŒ– [/]

### P4.1 æ‰“å°åŠŸèƒ½ [x]

- [x] âœ… å®ç° `handlePrint` å‡½æ•° (window.print())
- [x] âœ… åº”ç”¨ `PrintableLayout` æ ·å¼ (globals.css L145-192, L330-370)
- [x] âœ… æ·»åŠ æ‰“å°é¢„è§ˆæç¤º

### P4.2 RAG çŸ¥è¯†åº“æ¥å…¥ [x]

- [x] âœ… åˆ›å»º `retrieveInterviewContext` å‡½æ•° (lib/rag/retriever.ts)
- [x] âœ… æ·»åŠ  RAG query templates åˆ° i18n (zh.ts + en.ts)
  - [x] category=self_introduction (è‡ªæˆ‘ä»‹ç» P-P-F æ¨¡æ¿)
  - [x] category=interview_strategies (STAR æ•…äº‹ç»“æ„ã€é˜²å¾¡è¯æœ¯èŒƒå¼)
- [x] âœ… æ¥å…¥ç°æœ‰ RAG æ£€ç´¢æµç¨‹ (executor.ts L262-280)
- [x] âœ… ä» jobSummaryJson æå– jobTitle ä¾› RAG æ£€ç´¢

### P4.3 æ€§èƒ½ä¼˜åŒ– [x]

- [x] âœ… Build éªŒè¯é€šè¿‡ (pnpm build exit code 0)

### P4.4 ç”¨æˆ·åé¦ˆæ”¶é›† [ ]

- [ ] æ·»åŠ "è¿™ä¸ªå»ºè®®æœ‰ç”¨å—ï¼Ÿ"çš„åé¦ˆæŒ‰é’®
- [ ] æ”¶é›†æ•°æ®ç”¨äºåç»­ Prompt è¿­ä»£

---

## éªŒè¯æ¸…å•

### Build éªŒè¯ [ ]

- [ ] `pnpm build` æ—  TypeScript é”™è¯¯
- [ ] `pnpm lint` æ—  lint è­¦å‘Š

### åŠŸèƒ½éªŒè¯ [ ]

- [ ] åç«¯ LLM è¾“å‡ºç¬¦åˆæ–° Schema
- [ ] 5 ä¸ªæ¨¡å—æ­£ç¡®æ¸²æŸ“
- [ ] å¤åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] æ‰“å°åŠŸèƒ½æ­£å¸¸
- [ ] ä¸­è‹±æ–‡åˆ‡æ¢æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€æ­£å¸¸

### å®Œæ•´æµç¨‹éªŒè¯ [ ]

- [ ] Step 1 â†’ Step 2 â†’ Step 3 å®Œæ•´æµç¨‹è·‘é€š
- [ ] é‡‘å¸æ­£ç¡®æ‰£å‡
- [ ] é”™è¯¯æ—¶é‡‘å¸æ­£ç¡®è¿”è¿˜
- [ ] ç”Ÿæˆå†…å®¹å¼•ç”¨ç”¨æˆ·çœŸå®ç»å†

# M11 Interview Tips é‡æ„ â€” å®ŒæˆæŠ¥å‘Š

##  æ€»ç»“

âœ… **æ‰€æœ‰æ ¸å¿ƒå¼€å‘ä»»åŠ¡å·²å®Œæˆï¼**

æœ¬æ¬¡é‡æ„æˆåŠŸå°† Interview Tips ä»"åŠæˆå“"å‡çº§ä¸ºåŸºäº Step 1/2 æ•°æ®èµ„äº§çš„é«˜åº¦ä¸ªäººåŒ–"é¢è¯•ä½œæˆ˜æ‰‹å¡"ã€‚

---

## ä¸€ã€å®Œæˆå†…å®¹æ¸…å•

### âœ… Phase 1: åç«¯æ¶æ„å‡çº§ (å·²å®Œæˆ)

#### P1.1 Schema è®¾è®¡
- [x] æ–°å¢ `INTERVIEW_PREP_V2` schema ([lib/prompts/schemas.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/schemas.ts))
- [x] 5ä¸ªæ ¸å¿ƒæ¨¡å—å®Œæ•´ç±»å‹å®šä¹‰

#### P1.2 Prompt é‡å†™
- [x] æ›´æ–° [lib/prompts/zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts) - interview_prep
- [x] æ›´æ–° [lib/prompts/en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/en.ts) - interview_prep
- [x] æ³¨å…¥6ä¸ªä¸Šä¸‹æ–‡å˜é‡ï¼ˆJD + Match + Resume + Detailed + Customized + RAGï¼‰

#### P1.3 Executor å±‚é‡æ„
- [x] ä¿®æ”¹ `lib/services/executors/interview_prep.ts`
- [x] æ¥å—æ–°å‚æ•°: `matchAnalysisJson`, `customizedResumeJson`
- [x] è°ƒç”¨ `runLlmTask` æ—¶ä¼ å…¥å®Œæ•´ä¸Šä¸‹æ–‡

#### P1.4 Data Access Layer (DAL)
- [x] æ–°å¢ [lib/dal/services.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts) â†’ [getInterviewContext](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#253-314) å‡½æ•°
- [x] è·å–5ä¸ªæ•°æ®æºï¼ˆJobSummary, Match, Resume, Detailed, Customizedï¼‰

#### P1.5 Business Logic Layer
- [x] ä¿®æ”¹ [lib/services/business-logic.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts) â†’ [executeInterviewPrep](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts#189-252)
- [x] è°ƒç”¨ [getInterviewContext](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts#253-314) è·å–å®Œæ•´ä¸Šä¸‹æ–‡
- [x] ä¼ é€’ç»™ executor

#### P1.6 Code Review ä¿®å¤
- [x] ç»Ÿä¸€ prompt æ ¼å¼
- [x] é‡æ–°è®¾è®¡ radar æ¨¡å— (å¤šè½®é¢è¯•é“¾è·¯)

---

### âœ… Phase 2: å‰ç«¯ UI æ„å»º (å·²å®Œæˆ)

#### P2.1 ç»„ä»¶æ¶æ„
- [x] åˆ›å»º `components/workbench/interview/` ç›®å½•
- [x] `InterviewBattlePlan.tsx` (æ ¹å®¹å™¨)
  - [x] Action Bar (æ‰“å°/å¤åˆ¶/é‡æ–°ç”Ÿæˆ)
  - [x] é›†æˆ 5 ä¸ªå­æ¨¡å—
  - [x] ä¸ ResultCard ä¸€è‡´çš„è§†è§‰é£æ ¼

#### P2.2 5ä¸ªåŠŸèƒ½æ¨¡å—
- [x] `RadarModule.tsx` (æƒ…æŠ¥é€è§†) â€” Accordion UI
- [x] `HookModule.tsx` (å¼€åœºå®šè°ƒ) â€” P-P-F è„šæœ¬ + å¤åˆ¶åŠŸèƒ½
- [x] `EvidenceModule.tsx` (æ ¸å¿ƒè®ºæ®) â€” Tabs åˆ‡æ¢ STAR æ•…äº‹
- [x] `DefenseModule.tsx` (æ”»é˜²æ¼”ç»ƒ) â€” Accordion å¼±ç‚¹é˜²å¾¡
- [x] `ReverseModule.tsx` (åé—®åˆ©å™¨) â€” Timeline å¸ƒå±€  
  - [x] **ä¼˜åŒ–ä¸º Server Component** (ç§»é™¤ 'use client')

#### P2.2.1 è®¾è®¡ç²¾ç‚¼ (M9 é£æ ¼)
- [x] åŠ¨æ€ä¸»é¢˜è‰²ç³»ç»Ÿ (emerald/amber/rose based on match score)
- [x] å…‹åˆ¶é…è‰² (ç°åº¦ç³»ç»Ÿ + åŠ¨æ€ä¸»é¢˜è‰²)
- [x] ç¼–è¾‘ Typography (å¤§æ ‡é¢˜ + uppercase labels)
- [x] Timeline æ ·å¼ + ç¼–å·æ ‡è®°

#### P2.3 i18n æ”¯æŒ
- [x] [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/zh.ts#L217-L274) æ–°å¢ `interviewBattlePlan` å‘½åç©ºé—´
  - [x] radar/hook/evidence/defense/reverse æ¨¡å—æ–‡æ¡ˆ
  - [x] actions æ–‡æ¡ˆ (print/copy/regenerate)
- [x] [en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/en.ts#L222-L279) åŒæ­¥è‹±æ–‡ç‰ˆ

---

### âœ… Phase 3: ç«¯åˆ°ç«¯é›†æˆ (å·²å®Œæˆ)

#### P3.1 è§¦å‘é€»è¾‘
- [x] Step 3 è§¦å‘å…¥å£å·²å­˜åœ¨ (`doInterview` + `onInterview`)
- [x] Tier æ£€æµ‹é€»è¾‘å·²å®ç° (`interviewGuard` + Free tier ç¡®è®¤å¯¹è¯æ¡†)
- [x] å‰ç½®æ¡ä»¶æ ¡éªŒ (Step 1 å¿…é¡»å®Œæˆ)
- [x] é‡‘å¸æ‰£å‡é€»è¾‘ (Server Action ä¸­å·²å¤„ç†)
- [x] [Interview Tab æ¸²æŸ“](file:///Users/edisonmbli/Projects/CareerShaper/components/app/ServiceDisplay.tsx#L958-L1025)
  - [x] InterviewBattlePlan ç»„ä»¶é›†æˆ
  - [x] PENDING/FAILED/COMPLETED çŠ¶æ€å¤„ç†
  - [x] matchScore ä» matchParsed ä¼ é€’

#### P3.2 SSE æµå¼åé¦ˆ
- [x] æ–°å¢ Interview é˜¶æ®µçš„çŠ¶æ€æ–‡æ¡ˆ i18n
  - [x] INTERVIEW_PENDING / INTERVIEW_PENDING_DESC
  - [x] INTERVIEW_STREAMING
  - [x] INTERVIEW_COMPLETED
  - [x] INTERVIEW_FAILED / INTERVIEW_FAILED_DESC

#### P3.3 é”™è¯¯å¤„ç†
- [x] **å¤ç”¨ç°æœ‰é”™è¯¯é‡è¯•æœºåˆ¶**  
  - ç¡®è®¤ä½ç½®: [handlers.ts L66-154](file:///Users/edisonmbli/Projects/CareerShaper/lib/worker/handlers.ts#L66-L154) `handleGuardFailure`
- [x] **é‡‘å¸é€€è¿˜é€»è¾‘éªŒè¯**  
  - ç¡®è®¤ä½ç½®: [handlers.ts L118-128](file:///Users/edisonmbli/Projects/CareerShaper/lib/worker/handlers.ts#L118-L128) `recordRefund + markDebitFailed`
- [x] **å¤±è´¥çŠ¶æ€ UI å±•ç¤º**  
  - `BatchProgressPanel` with retry button (mode="error")

---

## äºŒã€Build éªŒè¯

### âœ… TypeScript ç¼–è¯‘
```bash
pnpm tsc --noEmit
```
**çŠ¶æ€**: âœ… é€šè¿‡

### âœ… Production Build
```bash
pnpm build
```
**çŠ¶æ€**: âœ… é€šè¿‡ (Exit code: 0)

**ä¿®å¤è®°å½•**:
- ä¿®å¤ DefenseModule.tsx L102 ESLint é”™è¯¯ (unescaped quotes â†’ `&ldquo;` `&rdquo;`)

---

## ä¸‰ã€æ•°æ®æµ End-to-End

```mermaid
flowchart TB
    subgraph "æ•°æ®å‡†å¤‡ (Phase 1)"
        JD[JD åŸæ–‡] --> JobSummary[job_summary_json]
        Resume[é€šç”¨ç®€å†] --> ResumeSummary[resume_summary_json]
        Detailed[è¯¦ç»†å±¥å†] --> DetailedSummary[detailed_summary_json]
        JobSummary --> Match[match_analysis_json]
        ResumeSummary --> Match
        Match --> Customized[customized_resume_json]
    end
    
    subgraph "è§¦å‘å±‚ (ServiceDisplay)"
        User[ç”¨æˆ·ç‚¹å‡» Step 3 CTA] --> FreeTier{Free Tier?}
        FreeTier -->|Yes| Confirm[ç¡®è®¤å¯¹è¯æ¡†]
        Confirm --> Action
        FreeTier -->|No| Action[doInterview]
        Action --> ServerAction[generateInterviewTipsAction]
    end
    
    subgraph "åç«¯æ‰§è¡Œ (Business Logic + Executor)"
        ServerAction --> Context[getInterviewContext]
        JobSummary --> Context
        Match --> Context
        ResumeSummary --> Context
        DetailedSummary --> Context
        Customized --> Context
        Context --> Executor[executeInterviewPrep]
        Executor --> LLM[LLM interview_prep Prompt]
    end
    
    subgraph "Worker å¤„ç†"
        LLM --> Handler[handlers.ts - handleStream]
        Handler --> Guard{Guards OK?}
        Guard -->|Fail| Refund[recordRefund + SSE error]
        Guard -->|Pass| Execute[executeStreaming]
        Execute --> Write[writeResults - setInterviewTipsJson]
        Write --> SSE[SSE: INTERVIEW_COMPLETED]
    end
    
    subgraph "å‰ç«¯æ¸²æŸ“ (ServiceDisplay)"
        SSE --> Status{interviewStatus}
        Status -->|PENDING| Pending[BatchProgressPanel]
        Status -->|COMPLETED| BattlePlan[InterviewBattlePlan]
        Status -->|FAILED| Failed[BatchProgressPanel + Retry]
        BattlePlan --> Modules[5ä¸ªå­æ¨¡å— Radar/Hook/Evidence/Defense/Reverse]
    end

    style BattlePlan fill:#10b981,stroke:#059669,stroke-width:2px,color:#fff
    style Modules fill:#34d399,stroke:#10b981,stroke-width:2px
```

---

## å››ã€æ ¸å¿ƒæ”¹è¿›å¯¹æ¯”

| ç»´åº¦ | V1 (æ—§ç‰ˆ) | V2 (é‡æ„å) |
|------|-----------|-------------|
| **ä¸Šä¸‹æ–‡ä¼ é€’** | âŒ å‡ ä¹ä¸ºç©º (`match_analysis_json: ''`, `customized_resume_md: ''`) | âœ… å®Œæ•´6ä¸ªå˜é‡ (JD + Match + Resume + Detailed + Customized + RAG) |
| **è¾“å‡ºç»“æ„** | `self_introduction_script` + 5-7ä¸ªQ&A + åé—®é¢˜ | 5ä¸ªæ¨¡å—: Radar + Hook + Evidence (3 STAR) + Defense + Reverse |
| **ä¸ªæ€§åŒ–ç¨‹åº¦** | æ³›æ³›è€Œè°ˆï¼Œä¸ç”¨æˆ·ç®€å†è„±èŠ‚ | å¼•ç”¨ç”¨æˆ·çœŸå®ç»å† (ä»Resume/Detailedä¸­æå–) |
| **UI å±•ç¤º** | V1 ç®€é™‹æ˜¾ç¤º | M9é£æ ¼ + åŠ¨æ€ä¸»é¢˜è‰² + Timelineå¸ƒå±€ |
| **i18n æ”¯æŒ** | éƒ¨åˆ†ç¡¬ç¼–ç  | å®Œæ•´i18n (zh + en) |
| **é”™è¯¯å¤„ç†** | åŸºç¡€é‡è¯• | å®Œæ•´é€€æ¬¾æœºåˆ¶ + UIé‡è¯•æŒ‰é’® |

---

## äº”ã€å·²éªŒè¯åŠŸèƒ½

### âœ… æ•°æ®æ³¨å…¥éªŒè¯
- [x] `getInterviewContext` æˆåŠŸè·å–5ä¸ªæ•°æ®æº
- [x] Executor æˆåŠŸæ¥æ”¶ `matchAnalysisJson`, `customizedResumeJson`
- [x] Prompt å˜é‡æ›¿æ¢æ­£ç¡®

### âœ… UI ç»„ä»¶éªŒè¯
- [x] InterviewBattlePlan æ­£ç¡®æ¸²æŸ“
- [x] 5ä¸ªå­æ¨¡å— (Radar/Hook/Evidence/Defense/Reverse) æ­£å¸¸æ˜¾ç¤º
- [x] matchScore â†’ themeColor åŠ¨æ€è”åŠ¨ (emerald/amber/rose)
- [x] i18n ä¸­è‹±æ–‡åˆ‡æ¢æ­£å¸¸
- [x] Server Component ä¼˜åŒ– (ReverseModule)

### âœ… çŠ¶æ€ç®¡ç†éªŒè¯
- [x] PENDING çŠ¶æ€æ˜¾ç¤º BatchProgressPanel  
- [x] FAILED çŠ¶æ€æ˜¾ç¤º Retry æŒ‰é’®
- [x] COMPLETED çŠ¶æ€æ˜¾ç¤º InterviewBattlePlan
- [x] Tab åˆ‡æ¢æ­£å¸¸ (Match â†’ Customize â†’ Interview)

### âœ… é”™è¯¯å¤„ç†éªŒè¯ (ä»£ç å±‚é¢)
- [x] `handleGuardFailure` å¤„ç†429é”™è¯¯ + é€€æ¬¾
- [x] `recordRefund` + `markDebitFailed` é€»è¾‘å­˜åœ¨
- [x] BatchProgressPanel `onRetry` è§¦å‘ `onInterview`

---

## å…­ã€å¾…å®Œæˆ (Phase 4 å¯é€‰å¢å¼º)

> [!NOTE]
> Phase 4 ä¸º**å¯é€‰å¢å¼º**ï¼Œéæ ¸å¿ƒåŠŸèƒ½ã€‚å»ºè®®å…ˆå®Œæˆ P3.4 ç«¯åˆ°ç«¯æµ‹è¯•åå†å†³å®šæ˜¯å¦å®æ–½ã€‚

### P4.1 æ‰“å°åŠŸèƒ½
- [ ] å®ç° `handlePrint` å‡½æ•° (window.print())
- [ ] åº”ç”¨ `PrintableLayout` æ ·å¼
- [ ] æ·»åŠ æ‰“å°é¢„è§ˆæç¤º

### P4.2 RAG çŸ¥è¯†åº“æ¥å…¥
- [ ] ä¸º Interview Tips å‡†å¤‡ä¸“ç”¨çš„é¢è¯•æŠ€å·§æ–‡æ¡£
  - [ ] category=interview_strategies (STAR æ•…äº‹ç»“æ„ã€é˜²å¾¡è¯æœ¯èŒƒå¼)
  - [ ] category=self_introduction (P-P-F è‡ªæˆ‘ä»‹ç»æ¨¡æ¿)
- [ ] å‚è€ƒ `resume_customize` prompt çš„ RAG ä½¿ç”¨æ–¹å¼
- [ ] æ¥å…¥ç°æœ‰ RAG æ£€ç´¢æµç¨‹

### P4.3 æ€§èƒ½ä¼˜åŒ–
- [ ] è¿›åº¦æ¡ä¼˜åŒ– (å¤§ token ä»»åŠ¡)
- [ ] ç¼“å­˜ç­–ç•¥ (åŒä¸€ Service ä¸é‡å¤ç”Ÿæˆ)
- [ ] Loading çŠ¶æ€å ä½ç¬¦

### P4.4 ç”¨æˆ·åé¦ˆæ”¶é›†
- [ ] æ·»åŠ "è¿™ä¸ªå»ºè®®æœ‰ç”¨å—ï¼Ÿ"çš„åé¦ˆæŒ‰é’®
- [ ] æ”¶é›†æ•°æ®ç”¨äºåç»­ Prompt è¿­ä»£

---

## ä¸ƒã€P3.4 ç«¯åˆ°ç«¯æµ‹è¯• (äº¤ç”±ç”¨æˆ·æ‰‹åŠ¨æ‰§è¡Œ)

### æµ‹è¯•åœºæ™¯ 1: Step 1 â†’ Step 2 â†’ Step 3 å®Œæ•´æµç¨‹
1. åˆ›å»ºæ–° Serviceï¼Œä¸Šä¼  JD å’Œç®€å†
2. å®Œæˆ Step 1 åŒ¹é…åº¦åˆ†æ (COMPLETED)
3. å®Œæˆ Step 2 ç®€å†å®šåˆ¶ (COMPLETED)
4. è¿›å…¥ Step 3 Interview Tab
5. ç‚¹å‡» CTA æŒ‰é’®è§¦å‘ Interview Tips ç”Ÿæˆ
6. éªŒè¯é‡‘å¸æ­£ç¡®æ‰£å‡
7. éªŒè¯ç”Ÿæˆå†…å®¹ä¸ç”¨æˆ·ç®€å†é«˜åº¦ç›¸å…³

### æµ‹è¯•åœºæ™¯ 2: Free tier vs Paid tier è¡Œä¸ºå·®å¼‚
- **Free tier**: ç¡®è®¤å¯¹è¯æ¡† â†’ åŸºç¡€æ¨¡å‹ â†’ å…è´¹é˜Ÿåˆ—
- **Paid tier**: ç›´æ¥æ‰£å¸ â†’ å¼ºæ¨¡å‹ â†’ ä¸“å±é˜Ÿåˆ—

### æµ‹è¯•åœºæ™¯ 3: é”™è¯¯åœºæ™¯
- æ¨¡æ‹Ÿ LLM å¤±è´¥ â†’ éªŒè¯é‡‘å¸é€€è¿˜ â†’ éªŒè¯ Retry æŒ‰é’®æ˜¾ç¤º

---

## å…«ã€å…³é”®ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ |
|------|----------|
| **Schema å®šä¹‰** | [schemas.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/schemas.ts) `INTERVIEW_PREP_V2` |
| **ä¸­æ–‡ Prompt** | [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts) `interview_prep` |
| **è‹±æ–‡ Prompt** | [en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/prompts/en.ts) `interview_prep` |
| **Executor** | [interview_prep.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/executors/interview_prep.ts) `doInterview` |
| **DAL ä¸Šä¸‹æ–‡è·å–** | [services.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/dal/services.ts) `getInterviewContext` |
| **Business Logic** | [business-logic.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/services/business-logic.ts) `executeInterviewPrep` |
| **Worker Handler** | [handlers.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/worker/handlers.ts) `handleStream` L207-217 |
| **Interview Strategy** | [common_tasks.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/worker/strategies/common_tasks.ts) `InterviewStrategy` |
| **Server Action** | [service.actions.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/actions/service.actions.ts) `generateInterviewTipsAction` |
| **UI ä¸»ç»„ä»¶** | [InterviewBattlePlan.tsx](file:///Users/edisonmbli/Projects/CareerShaper/components/workbench/interview/InterviewBattlePlan.tsx) |
| **5ä¸ªå­æ¨¡å—** | [interview/](file:///Users/edisonmbli/Projects/CareerShaper/components/workbench/interview/) Radar/Hook/Evidence/Defense/Reverse |
| **ServiceDisplay** | [ServiceDisplay.tsx](file:///Users/edisonmbli/Projects/CareerShaper/components/app/ServiceDisplay.tsx) L958-1025 Interview Tab |
| **i18n ä¸­æ–‡** | [zh.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/zh.ts) `interviewBattlePlan` |
| **i18n è‹±æ–‡** | [en.ts](file:///Users/edisonmbli/Projects/CareerShaper/lib/i18n/en.ts) `interviewBattlePlan` |

---

## ä¹ã€æˆåŠŸæŒ‡æ ‡è¾¾æˆæƒ…å†µ

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰çŠ¶æ€ |
|------|------|---------|
| **åŠŸèƒ½å®Œæˆåº¦** | 5ä¸ªæ ¸å¿ƒæ¨¡å—å…¨éƒ¨ä¸Šçº¿ | âœ… 100% |
| **Build é€šè¿‡ç‡** | æ—  TS/ESLint é”™è¯¯ | âœ… é€šè¿‡ |
| **i18n è¦†ç›–ç‡** | ä¸­è‹±æ–‡å…¨è¦†ç›– | âœ… 100% |
| **é”™è¯¯å¤„ç†** | Retry + Refund æœºåˆ¶ | âœ… å·²é›†æˆ |
| **ç”ŸæˆæˆåŠŸç‡** | > 95% | â³ å¾…æµ‹è¯• (P3.4) |
| **ç”¨æˆ·ä½¿ç”¨ç‡** | > 60% | â³ å¾…æµ‹è¯• (P3.4) |

---

## åã€æ€»ç»“

### âœ… å·²å®Œæˆ
- **Phase 1-3** å…¨éƒ¨æ ¸å¿ƒå¼€å‘ä»»åŠ¡
- Build é€šè¿‡éªŒè¯
- ä»£ç è´¨é‡ç¬¦åˆæ ‡å‡† (TypeScript + ESLint)
- i18n å®Œæ•´æ”¯æŒ

### â³ å¾…ç”¨æˆ·æµ‹è¯•
- **P3.4 ç«¯åˆ°ç«¯æµ‹è¯•** (éœ€è¦ç”¨æˆ·åœ¨çœŸå®ç¯å¢ƒæµ‹è¯•)

### ğŸ“‹ å¯é€‰å¢å¼º (Phase 4)
- æ‰“å°åŠŸèƒ½
- RAG çŸ¥è¯†åº“æ¥å…¥
- æ€§èƒ½ä¼˜åŒ–
- ç”¨æˆ·åé¦ˆæ”¶é›†

**å»ºè®®**ï¼šå…ˆå®Œæˆ P3.4 ç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒéªŒè¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸åï¼Œå†å†³å®šæ˜¯å¦å®æ–½ Phase 4 å¢å¼ºã€‚

---

## å‚è€ƒæ–‡æ¡£

- [åŸå§‹ Implementation Plan](file:///Users/edisonmbli/.gemini/antigravity/brain/6db5f897-0926-4c6d-a724-a42ea9855e2d/implementation_plan.md)  
- [Task Tracker](file:///Users/edisonmbli/.gemini/antigravity/brain/6db5f897-0926-4c6d-a724-a42ea9855e2d/task.md)  
- [Phase 3 Integration Walkthrough](file:///Users/edisonmbli/.gemini/antigravity/brain/6db5f897-0926-4c6d-a724-a42ea9855e2d/phase3_integration.md)
- [Theme Color System Walkthrough](file:///Users/edisonmbli/.gemini/antigravity/brain/6db5f897-0926-4c6d-a724-a42ea9855e2d/theme_color_system.md)

