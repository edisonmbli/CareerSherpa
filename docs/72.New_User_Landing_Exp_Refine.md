# 用户冷启动与资产建设重构｜技术分期执行计划

## 目标与原则

- 目标：通过状态驱动 UI、情境式拦截、游戏化反馈，引导用户完成履历深度盘点与资产沉淀
- 原则：迭代交付，严格分期推进；每期可独立验证与回滚

## Phase 0：数据库 Schema 更新

### 变更点

- 在 `resumes` 表增加结构化画像字段 `parsed_profile_json`
- 文件路径：/Users/edisonmbli/Projects/CareerShaper/prisma/schema.prisma

### 影响范围

- 仅结构存储扩展，不改变现有 `resume_summary_json` 读取逻辑
- 后续 Phase 1 LLM 结果将写入该字段

### 交付与验证

- 你手工执行 migration 并通知结果
- 成功标准：`parsed_profile_json` 可读写、与 `user_id` 关联正常

## Phase 1：数据层与 LLM 链路升级（后端/数据层）

### 目标

- 让通用简历解析产出结构化画像，形成可视化资产基础

### 关键改动

- DB：Resume 结构化画像写入 `parsed_profile_json`
- Prompt：升级简历解析任务，输出 Summary + Profile 核心要素
  - 路径：/Users/edisonmbli/Projects/CareerShaper/lib/prompts/zh.ts
  - 路径：/Users/edisonmbli/Projects/CareerShaper/lib/prompts/en.ts
- Actions/Workers：解析结果落表与返回结构体升级
  - 预计涉及：`lib/actions/resume.actions.ts`、相关 worker 解析流程

### 输出结构建议（示例）

- `profile_core_tags`: string[]
- `experience_focus`: string（如“5年B端SaaS增长”）
- `signature_project`: string（一句话高光项目）
- `strengths_summary`: string（2-3句核心优势）

### 交付与验证

- 单元：解析任务输出校验（Zod）
- 集成：上传通用简历后能读取 `parsed_profile_json`

## Phase 2：全局状态定义与首页路由重构（前端）

### 目标

- 基于“资产是否就绪”驱动首页引导与路由，提升冷启动体验

### 状态管理策略

- 在 Server Component 侧计算 `isAssetReady`
  - 来源：`getLatestResume` 的 `status === COMPLETED` 且 `resume_summary_json` 存在
  - 由 RSC 向 Client 组件下发，避免依赖注册回调
- 对需要客户端复用的场景，提供轻量 selector（不引入新的全局 store）

### 主要改动点

- `/zh` 首页文案与 CTA
  - 文件：/Users/edisonmbli/Projects/CareerShaper/components/landing/HeroSection.tsx
  - 文件：/Users/edisonmbli/Projects/CareerShaper/components/landing/CtaSection.tsx
- CTA 路由统一指向 `/zh/workbench`
- 多语言文案：若需要提升一致性，补充 `lib/i18n/zh.ts` `lib/i18n/en.ts`

### 组件拆分思路

- Hero/Cta 仅处理文案与跳转行为
- 文案变化需抽离字典字段到 i18n，避免硬编码

## Phase 3：工作台情境式拦截（前端 `/zh/workbench`）

### 目标

- 用户在最想使用 AI 功能时被温和引导完成资产建设

### 逻辑与渲染

- 通过 `isAssetReady` 条件渲染
- `isAssetReady === false` 时：
  - 置灰或隐藏 JD 上传与匹配表单
  - 显示高品质 Empty State 组件（含引导文案与 CTA）
  - CTA 跳转 `/zh/profile?tab=assets`
- `isAssetReady === true` 时：
  - 正常显示工作台
  - 顶部轻量成功提示（如“✅ AI 私教已读取您的履历，随时待命”）

### 组件拆分思路

- `WorkbenchAssetGate`：负责空状态与禁用逻辑
- `WorkbenchReadyBanner`：成功态轻量提示
- 现有工作台表单保持原组件，避免侵入式改动

## Phase 4：个人经历页游戏化重构（前端 `/zh/profile?tab=assets`）

### 目标

- 将上传过程变成“打造数字分身”的游戏化体验

### 新增组件

- `AssetProgressMeter`（顶部进度条）
  - 0%：无简历
  - 60%：仅通用简历
  - 100%：通用 + 详细履历
- `ProfilePersonaPanel`（右侧视觉焦点）
  - 读取 `parsed_profile_json` 逐步点亮技能与经验
  - 完成后提供高优先级 CTA “资产已就绪，去匹配岗位”
- 需要兼顾移动端布局适配

### 数据来源

- 通用简历与详历状态：`getLatestResume` / `getLatestDetailedResume`
- 结构化画像：`parsed_profile_json`

### 组件拆分思路

- Profile 页面仍为 RSC，数据在服务端聚合
- 交互组件拆分为 Client 子组件（进度条、Profile 面板、CTA）

## 依赖与风险控制

- Prompt 改动需同步后端解析与前端展示字段
- 空状态和拦截 UI 需确保不影响已有用户主流程
- 状态判定需兼容旧数据（无 `parsed_profile_json`）

## 交付顺序与验收

- Phase 0：Schema 更新完成
- Phase 1：LLM 输出结构化画像并落表
- Phase 2：/zh 路由与文案调整完成
- Phase 3：工作台空状态与拦截完成
- Phase 4：资产页进度条与画像面板完成
