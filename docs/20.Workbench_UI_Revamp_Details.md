# Workbench 页深度重构说明与落地指南（M9 视觉与体验优化）

> 目标：将 Step 1 匹配度分析的「已可用」提升为「专业、现代、优雅」的体验基线，并为 Step 2/Step 3 的拓展打下统一的 UI/UX 设计地基。遵循 2.6 设计系统与 2.5 页面架构，兼顾移动端与 i18n。

---

## 一、问题诊断与根因

- 信息层级缺乏：主内容直接铺在背景上，未充分使用 `Card`/`Surface` 形成层级与呼吸感，排版密度不平衡。
- 过程感知缺失：流式与轮询的反馈被分散在多个提示中（Toast/文案），没有统一、可回溯的「运行状态单元」。
- 空/中间态设计不足：未生成、排队、进行中、失败等中间态缺少专用样式与文案策略，导致焦虑感与不确定性。
- 步进心智不一致：三步流程以垂直列表呈现，缺乏现代化的「水平进度条」语义，锁定/解锁逻辑不清晰。
- 结果承载薄弱：流式期间展示原始 JSON 视觉负担大；完成后缺少结构化结果卡片与就近操作（复制/导出）。
- 移动端适配不足：侧栏密度与交互在移动端不友好；主内容滚动与流式区域易造成整页滚动混乱。
- i18n 粒度不足：部分静态文案未完全出自字典；日期/数字格式未随 locale 切换。

---

## 二、设计原则与体验目标

- 单一工作流心智：所有反馈围绕当前 `serviceId` 的「运行」展开；历史与来源仅作为辅助，不打断主线。
- 渐进披露：先呈现概览与关键结论，再允许展开证据/原始 JSON；默认折叠沉重信息。
- 双通道反馈：视觉（进度、颜色、动效）+语义（精炼文案）；失败信息提供去控制台查看详情的桥接。
- 流式优先：核心内容区支持 SSE 流式，用户在流过程中可取消；首段文字尽快出现（≤2s）。
- 操作就近：复制、导出、保存等操作与结果卡片紧邻；CTA 按钮与金币提示在同一区域。
- 移动端优先：主内容单列满宽，侧栏以抽屉呈现；流式区限定高度、独立滚动；底部吸附 CTA。
- i18n 完整：UI 文案、提示、日期/数字格式均随 locale 切换；中英 Prompt 文案保持一致的语义强度。

---

## 三、信息架构与布局

- 两列布局（桌面端）：左侧 `SidebarHistory`（固定 272–320px），右侧 `Main Workspace`（弹性宽度，内容最大 `max-w-3xl`）。
- 单列布局（移动端）：隐藏侧栏，顶部 `Header` 提供汉堡菜单唤起 `MobileDrawer`；主内容占满宽度。
- 主内容区层次：
  1. `StepperProgress`（水平三步进度，置顶）
  2. `StatusConsole`（统一状态面板：进度、队列、金币、最近更新时间）
  3. `StreamPanel` / `ResultCard`（根据状态切换：流式中/完成/失败）
  4. `CTA Bar`（下一步动作与金币提示）

---

## 四、组件规范（文件名与职责）

1. `components/workbench/SidebarHistory.tsx`

   - 内容：历史服务列表，仅显示 `company + jobTitle`；右侧状态徽章移除，改为 hover 显示更多信息。
   - 列表规则：默认展示最新 8 条、倒序；滚动加载更多；搜索与状态筛选可选。
   - 视觉：`bg-card` 容器，内部 `gap-2` 列表项，项内 `title`（加粗）+ `subtitle`（`text-muted-foreground`）。
   - 可访问性：`role="navigation"`、当前项 `aria-current="page"`。

2. `components/workbench/StepperProgress.tsx`

   - 内容：水平三步：`Step 1: 匹配度`、`Step 2: 改简历`、`Step 3: 面试 Tips`。
   - 状态：`locked/idle/running/completed/failed`；Step 2/3 在未解锁时置灰且不可点击。
   - 交互：点击已解锁步骤切换 Tab；Hover 显示解锁条件（例如完成上一步）。
   - 可访问性：`aria-label="流程进度"`，当前步骤 `aria-current="step"`。

3. `components/workbench/StatusConsole.tsx`

   - 内容：统一反馈的「单一事实源」。
   - 第 1 行：左侧为状态文本与动效指示（idle/streaming/completed/error）；右侧为两个徽章：`队列(FREE/PRO)` 与 `金币扣减(-N)`。
   - 第 2 行：水平进度条 + 最近更新时间文本。
   - 错误态：以 `Alert (destructive)` 样式替换进度条，文案含简短原因与“打开详细日志”。
   - 辅助：右下角 Toast 栈交由此组件统一管理；点击 Toast 打开详情（未来可用 `Sheet`/`Drawer`）。

4. `components/workbench/StreamPanel.tsx`

   - 内容：流式期间的沉浸式输出容器。
   - 视觉：置灰、不可点击的小卡片；`max-h-[60vh]`、`overflow-y-auto`，`font-mono` 渲染 token；对 `{ } , : "` 等 JSON 符号降透明。
   - 交互：显示 `progress` 与 `timestamp`；提供查看原始 JSON 的折叠区；支持 `取消` 操作。

5. `components/workbench/ResultCard.tsx`

   - 内容：完成态的结构化结果（评分、要点、短板、话术）。
   - 视觉：`<article class="prose prose-slate max-w-none">`；顶部插入评分可视化（分数徽章或环形图）。
   - 操作：右侧提供 `复制` 按钮（对 `cover_letter_script` 重点提供）、`导出 Markdown/JSON`（对定制化简历）。

6. `components/workbench/MobileDrawer.tsx`

   - 内容：移动端侧栏抽屉，包含历史服务、搜索、语言切换、设置入口。
   - 行为：打开后焦点锁定（Focus Trap），支持键盘导航；底部提供 `StatusConsole` 快捷入口。

7. `components/workbench/I18nSwitch.tsx`
   - 内容：语言切换（中文/English），与 App Router 的 locale 路径协作；切换时保留当前上下文。
   - 文案：所有静态文本必须从 `getDictionary(locale)` 加载；日期/数字格式通过 `Intl` API 按 locale 渲染。

---

## 五、状态与文案规范（五态扩展）

- Idle：按钮正常可用；文案如 `准备就绪`。
- Queued：按钮禁用；Toast 提示 `（免费队列）任务已提交，正在排队...`；侧栏项显示 `排队中`。
- Processing（流式）：主卡片进入 `StreamPanel`；状态文本显示 `正在分析岗位关键词...`；进度条与脉冲指示同时存在。
- Success：切换为 `ResultCard`；Toast 成功提示；CTA 解锁下一步。
- Failed：`Alert (destructive)` 占位；文案 `任务执行失败。金币已自动退回您的账户。`；允许重试。

文案来源：统一从 i18n 字典读取键值，例如 `Workbench.Status.streaming`, `Workbench.Toast.success`。

---

## 六、视觉规范与令牌（与 2.6 保持一致）

- 颜色：`primary=blue`；`success=green`；`warning=amber`；`destructive=red`；严格使用 `text-muted-foreground` 描述文字。
- 间距：卡片内部 `p-6`，卡片之间 `gap-6/8`；紧密元素组使用 `gap-2/4`。
- 排版：H1/H2 使用 `text-2xl lg:text-3xl`、`font-semibold`；正文 `text-base leading-relaxed`；Muted 文本 `text-sm text-muted-foreground`。
- 分隔：优先使用间距与背景层级，避免过度边框；输入区边框使用 `border-border`。

---

## 七、交互细节（桌面/移动）

- 桌面：侧栏常显，历史列表 hover 显示更多信息；主区内容宽度限制，结果阅读舒适。
- 移动：隐藏侧栏，顶部 `Header` + `MobileDrawer`；`StreamPanel` 设置 `max-h` 并独立滚动；CTA 采用 `Sticky Footer`。
- 滚动策略：SSE 开始时自动滚动到 `StreamPanel`；完成后滚动到 `ResultCard` 顶部。

---

## 八、实现路线（面向前端工程师）

1. 布局重构（RSC 容器不变）：

   - 在 `app/[locale]/workbench/[serviceId]/page.tsx` 引入 `StepperProgress` 与 `StatusConsole`，替换现有垂直步骤与散落状态。
   - 根据 `useWorkbenchStore` 的状态枚举切换 `StreamPanel` 与 `ResultCard`。

2. 侧栏改造：

   - 替换历史项渲染为 `SidebarHistory`；仅显示 `company + jobTitle`，移除右侧状态徽章；hover 露出更多信息。
   - 默认展示 8 条、倒序；支持滚动加载更多。

3. 流式体验优化：

   - `StreamPanel` 对 JSON 符号降透明，突出文本；首屏 Skeleton + 进度条延迟不超过 0.5s。
   - SSE 首 token 目标 P95 ≤ 8s；`StatusConsole` 显示最近更新时间。

4. CTA 行为与金币提示：

   - Step 1 Tab：`帮我改简历`；Step 2 Tab：`面试 Tips`；扣费校验与降级提示使用统一 Toast。
   - 按钮旁显示金币图标与 `hover: 使用该服务，将扣减 xx 金币`。

5. i18n 与可访问性：

   - 所有文案从 `getDictionary(locale)` 加载；日期、数字用 `Intl` 渲染。
   - 语义标签与 ARIA：`nav/aside/main/section`；Live Region：流式区 `aria-live="polite"`，错误 `assertive`。

6. 性能与一致性：
   - 历史长列表采用虚拟化；折叠区按需渲染。
   - Toast 限流与合并；最多显示 3 条并入栈控制台。

---

## 九、验收标准（DoD）

- 视觉：`/design-system` 验证通过；Workbench 主区统一使用 `Card` 容器，间距与色彩符合 2.6。
- 交互：五态齐备；SSE 流式开始自动滚动；Toast 与 StatusConsole 状态一致。
- 可用性：桌面与移动端均无布局溢出；侧栏抽屉在移动端可正常导航。
- i18n：页面上所有静态文本、状态文案与日期/数字显示均随 locale 切换。
- 性能：P95 首 token ≤ 8s；长列表滚动流畅；无阻塞渲染。

---

## 十、文件对照与改动清单（为后续实现准备）

- 页面：`app/[locale]/workbench/[serviceId]/page.tsx`（集成 Stepper/Status/Stream/Result/CTA）。
- 侧栏：`components/workbench/SidebarHistory.tsx`（替换现有历史列表渲染）。
- 进度：`components/workbench/StepperProgress.tsx`（替代垂直列表）。
- 状态：`components/workbench/StatusConsole.tsx`（统一状态与 Toast）。
- 流式：`components/workbench/StreamPanel.tsx`（沉浸式流式区）。
- 结果：`components/workbench/ResultCard.tsx`（完成态结果卡片）。
- 移动：`components/workbench/MobileDrawer.tsx`（移动端抽屉）。
- 国际化：`components/workbench/I18nSwitch.tsx`（语言切换）。

上述组件需遵循 shadcn/ui 组合、Tailwind 令牌，以及 2.6 的色彩与间距规范；实现时保持 Server Components 为主、交互在 Client Components 内。

## 十一、执行计划

### 阶段 1：统一流程与状态

- 引入水平步骤条 StepperProgress ，明确锁定/解锁规则与点击行为
- 实装唯一状态面板 StatusConsole ，整合进度、队列标识、金币提示
- 优化流式期间展示 StreamPanel ，降透明呈现 JSON 符号、限定高度独立滚动
- 完成态结构化展示 ResultCard ，就近提供复制操作
- 验收：五态文案统一、SSE 开始自动滚动、桌面端主区卡片化

### 阶段 2：侧栏与历史列表

- 重构历史列表为 SidebarHistory ：仅展示 company + jobTitle ，默认 8 条倒序，滚动加载更多，hover 显示更多信息
- 移动端将侧栏抽屉化 MobileDrawer ，保留搜索与语言切换
- 验收：移动端抽屉可用、历史列表信息密度与层级符合 2.6 规范

### 阶段 3：CTA 与金币提示

- 将 CTA 统一至页面底部区域，区分 Step1/Step2 的操作与金币扣减提示
- 校验金币余额与降级提示（FREE 队列），统一由 StatusConsole 管理 Toast
- 验收：扣费与降级提示一致、CTA 在桌面端与移动端均易点击

### 阶段 4：i18n 与可访问性收口

- 全量文案从字典加载，日期与数字通过 Intl 随 locale 格式化
- 补充 ARIA 与 Live Region：流程进度、流式输出、错误提示
- 验收： /design-system 通过，axe 扫描无严重可访问性问题

### 阶段 5：性能与一致性

- 历史列表虚拟化，折叠区按需渲染
- Toast 限流与合并，StatusConsole 作为“单一事实源”统一透传
- 验收：P95 首 token ≤ 8s，滚动与流式渲染顺畅

---

## 十二、ResultCard 深度优化方案（Bento Modular）

> 核心理念：高密度、结构化、现代感。将不同的信息维度切割为独立的“功能块”，类似 Linear 或 Apple 系统的 Widget 设计。

### 1. 视觉与布局规范

- **整体风格**：引入低饱和度、高透明度的色彩点缀，打破黑白灰沉闷感，同时适配 Light/Dark 模式。
- **Grid 布局**：
  - **Header 区**：大号环形进度条（分数） + 核心元数据（Assessment Badge）。
  - **Block A（优势）**：带图标的卡片列表，点击/Hover 展开 Evidence。
  - **Block B（短板）**：问题 -> 建议（Suggestion）的对照结构，使用警示色点缀。
  - **Smart Pitch（话术）**：代码编辑器风格，高亮 `[H]` `[V]` `[C]` 标签。

### 2. 关键交互细节

- **智能复制**：界面上高亮展示 `[H]` `[V]` `[C]` 标签以辅助理解，但点击“复制”按钮时，**自动剔除**这些标签，确保用户可直接粘贴。
- **动态高度与滚动**：
  - 页面布局遵循 `Flex Column` 模型。
  - 高度计算公式：`Viewport Height = Header + Stepper + StatusConsole + ResultCard (Flex Grow) + CTA`。
  - `ResultCard` 内部实现 `ScrollArea`，确保 CTA 区域永远吸底且不被挤出首屏（最低不低于侧栏底部）。
- **CTA 文案优化**：
  - 去除“金币”文字，仅保留 Icon。例：“预计消耗 2 <Icon>”。

### 3. 数据映射补全

- 确保 `overall_assessment`、`evidence` (Highlights)、`suggestion` (Gaps) 字段被正确映射和展示。
